\input{macros}



\documentclass{article}
\usepackage{amsmath}
\usepackage{mathpartir}
\usepackage{empheq}
\begin{document}

\begin{mathpar}
\inferrule[Constant Lens]
{
\String_1 \in \Sigma^*
\String_2 \in \Sigma^*
}
{
\Delta \vdash const(\String_1,\String_2) : \String_1 \Leftrightarrow \String_2 \{\String_1 \leftrightarrow \String_2 \}
}

\inferrule[Identity Lens]
{
\Delta \vdash \String_1 : \Regex\\
\ldots\\
\Delta \vdash \String_n : \Regex\\
}
{
\Delta \vdash \IdentityLens : \Regex \Leftrightarrow \Regex \{\String_1 \leftrightarrow \String_1 , \ldots , \String_n \leftrightarrow \String_n \}
}

\inferrule[Iterate Lens]
{
\Delta \vdash \Lens : \Regex_1 \Leftrightarrow \Regex_2
\{\String_{1,1,1} \leftrightarrow \String_{1,1,2},
\ldots ,
\String_{1,n_1,1} \leftrightarrow \String_{1,n_1,2},
\ldots,
\String_{m,1,1} \leftrightarrow \String_{m,1,2},
\ldots ,
\String_{m,n_m,1} \leftrightarrow \String_{m,n_m,2}\} \\
\Regex_1^{!*}\\
\Regex_2^{!*}\\
}
{
\Delta \vdash \IterateLens{\Lens} : \Star{\Regex_1} \Leftrightarrow \Star{\Regex_2}
\{\String_{1,1,1}\ldots\String_{1,n_1,1} \leftrightarrow \String_{1,1,2}\ldots\String_{1,n_1,2},
\ldots ,
\String_{m,1,1}\ldots\String_{m,n_m,1} \leftrightarrow \String_{m,1,2}\ldots\String_{m,n_m,2}
}

\inferrule[Concat Lens]
{
\Delta \vdash \Lens_1 : \Regex_{1,1} \Leftrightarrow \Regex_{1,2} \{s_{1,1,1} \leftrightarrow s_{1,1,2}, \ldots s_{1,n,1}, \leftrightarrow s_{1,n,2}\} \\
\Delta \vdash \Lens_2 : \Regex_{2,1} \Leftrightarrow \Regex_{2,2} \{s_{2,1,1} \leftrightarrow s_{2,1,2}, \ldots s_{2,n,1}, \leftrightarrow s_{2,n,2}\}\\
\Regex_{1,1} .! \Regex_{2,1}\\
\Regex_{1,2} .! \Regex_{2,2}\\
}
{
\Delta \vdash \ConcatLens{\String_1}{\String_2} : \Regex_{1,1}\Regex_{2,1} \Leftrightarrow \Regex_{1,2}\Regex_{2,2} \{s_{1,1,1}s_{2,1,1} \leftrightarrow s_{1,1,2}s_{2,1,2}, \ldots s_{1,n,1}s_{2,n,1}, \leftrightarrow s_{1,n,2}s_{2,n,2}\}
}

\inferrule[Swap Lens]
{
\Delta \vdash \Lens_1 : \Regex_{1,1} \Leftrightarrow \Regex_{1,2} \{s_{1,1,1} \leftrightarrow s_{1,1,2}, \ldots s_{1,n,1}, \leftrightarrow s_{1,n,2}\} \\
\Delta \vdash \Lens_2 : \Regex_{2,1} \Leftrightarrow \Regex_{2,2} \{s_{2,1,1} \leftrightarrow s_{2,1,2}, \ldots s_{2,n,1}, \leftrightarrow s_{2,n,2}\}\\
\Regex_{1,1} .! \Regex_{2,1}\\
\Regex_{2,2} .! \Regex_{1,2}\\
}
{
\Delta \vdash \ConcatLens{\String_1}{\String_2} : \Regex_{1,1}\Regex_{2,1} \Leftrightarrow \Regex_{2,2}\Regex_{1,2}
\{s_{1,1,1}s_{2,1,1} \leftrightarrow s_{2,1,2}s_{1,1,2}, \ldots,
 s_{1,n,1}s_{2,n,1}, \leftrightarrow s_{2,n,2}s_{1,n,2}\}
}

\inferrule[Or Lens]
{
\Delta \vdash \Lens_1 : \Regex_{1,1} \Leftrightarrow \Regex_{1,2} \{s_{1,1,1} \leftrightarrow s_{1,1,2}, \ldots s_{1,n,1}, \leftrightarrow s_{1,n,2}\} \\
\Delta \vdash \Lens_2 : \Regex_{2,1} \Leftrightarrow \Regex_{2,2} \{s_{2,1,1} \leftrightarrow s_{2,1,2}, \ldots s_{2,m,1}, \leftrightarrow s_{2,m,2}\} \\
\Regex_{1,1} \cap \Regex_{2,1} = \emptyset\\
\Regex_{1,2} \cap \Regex_{2,2} = \emptyset\\
}
{
\Delta \vdash \OrLens{\Lens_1}{\Lens_2} : \Regex_{1,1} | \Regex_{2,1} \Leftrightarrow \Regex_{1,2} | \Regex_{2,2} \{s_{1,1,1} \leftrightarrow s_{1,1,2}, \ldots s_{1,n,1}, \leftrightarrow s_{1,n,2},
s_{2,1,1} \leftrightarrow s_{2,1,2}, \ldots s_{2,m,1}, \leftrightarrow s_{2,m,2}\}
}

\inferrule[Compose Lens]
{
\Delta \vdash \Lens_1 : \Regex_1 \Leftrightarrow \Regex_2 \{s_{1,1} \leftrightarrow s_{1,2}, \ldots, s_{n,1} \leftrightarrow s_{n,2}\} \\
\Delta \vdash \Lens_2 : \Regex_2 \Leftrightarrow \Regex_3 \{s_{1,2} \leftrightarrow s_{1,3}, \ldots, s_{n,2} \leftrightarrow s_{n,3}\} \\
}
{
\Delta \vdash \ComposeLens{\Lens_2}{\Lens_1} : \Regex_1 \Leftrightarrow \Regex_3 \{s_{1,1} \leftrightarrow s_{1,3}, \ldots, s_{n,1} \leftrightarrow s_{n,3}\}
}
\end{mathpar}


\end{document}
