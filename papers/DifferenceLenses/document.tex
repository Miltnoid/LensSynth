\newif\ifdraft\drafttrue  % set true to show comments
\newif\ifplentyoftime\plentyoftimefalse  % :-)



% % For double-blind review submission, w/o CCS and ACM Reference (max
% submission space)
\documentclass[acmsmall,review,anonymous]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
% % For double-blind review submission, w/ CCS and ACM Reference
% \documentclass[acmsmall,review,anonymous]{acmart}\settopmatter{printfolios=true}
% % For single-blind review submission, w/o CCS and ACM Reference (max
% submission space)
% \documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
% % For single-blind review submission, w/ CCS and ACM Reference
% \documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true} % For
% final camera-ready submission, w/ required CCS and ACM Reference
% \documentclass[acmsmall]{acmart}\settopmatter{}


% % Journal information % Supplied to authors by publisher for camera-ready
% submission; % use defaults for review submission.
\acmJournal{PACMPL}
\acmVolume{1}
\acmNumber{ICDP} % CONF = POPL or ICFP or OOPSLA
\acmArticle{1}
\acmYear{2018}
\acmMonth{1}
\acmDOI{} % \acmDOI{10.1145/nnnnnnn.nnnnnnn}
\startPage{1}

% % Copyright information % Supplied to authors (based on authors' rights
% management selection; % see authors.acm.org) by publisher for camera-ready
% submission; % use 'none' for review submission.
\setcopyright{none}
% \setcopyright{acmcopyright} \setcopyright{acmlicensed}
% \setcopyright{rightsretained} \ccopyrightyear{2018}           %% If different
% from \acmYear

% % Bibliography style %\bibliographystyle{ACM-Reference-Format} % Citation
% style % Note: author/year citations are required for papers published as an %
% issue of PACMPL.
% %\citestyle{acmauthoryear}   %% For author/year citations


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% % Note:
% Authors migrating a paper from PACMPL format to traditional % SIGPLAN
% proceedings format must update the '\documentclass' and % topmatter commands
% above; see 'acmart-sigplanproc-template.tex'.
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\usepackage{amsmath, amssymb, amsthm, enumerate, graphicx, centernot, tikz,
array, tikz-cd, extarrows, cleveref, mathrsfs, mathtools, stmaryrd}
\usepackage{listings}

\newtheorem{definition}{Definition}
\newtheorem{example}{Example}
\newtheorem{conjecture}{Conjecture}
\newtheorem{question}{Question}
\newtheorem{fact}{Fact}
\newtheorem{claim}{Claim}

% Macros
% Colors
\definecolor{dkblue}{rgb}{0,0.1,0.5}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{dkred}{rgb}{0.6,0,0}
\definecolor{dkpurple}{rgb}{0.7,0,0.4}
\definecolor{olive}{rgb}{0.4, 0.4, 0.0}
\definecolor{teal}{rgb}{0.0,0.5,0.5}
\definecolor{orange}{rgb}{0.9,0.6,0.2}
\definecolor{lightyellow}{RGB}{255, 255, 179}
\definecolor{lightgreen}{RGB}{170, 255, 220}
\definecolor{teal}{RGB}{141,211,199}
\definecolor{darkbrown}{RGB}{121,37,0}

\newcommand{\FINISH}[3]{\ifdraft\textcolor{#1}{[#2: #3]}\fi}
\newcommand{\bcp}[1]{\FINISH{dkred}{B}{#1}}
\newcommand{\BCP}[1]{\FINISH{dkred}{B}{\bf #1}}
\newcommand{\afm}[1]{\FINISH{dkgreen}{A}{#1}}
\newcommand{\dpw}[1]{\FINISH{dkblue}{D}{#1}} % Toronto Maple Leafs Blue :-)
\newcommand{\saz}[1]{\FINISH{orange}{SZ}{#1}}
\newcommand{\ksf}[1]{\FINISH{teal}{K}{#1}}
\newcommand{\sam}[1]{\FINISH{dkpurple}{SM}{#1}}


\newcommand{\kw}[1]{\ensuremath{\mathsf{#1}}}
\newcommand{\get}{\ensuremath{\kw{get}}}
\newcommand{\pput}{\ensuremath{\kw{put}}}
\newcommand{\create}{\ensuremath{\kw{create}}}
\newcommand{\ccopy}{\ensuremath{\kw{copy}}}
\newcommand{\const}{\ensuremath{\kw{const}}}
\newcommand{\default}{\ensuremath{\kw{default}}}


\lstset{ basicstyle=\ttfamily, escapeinside=|| }
\begin{document}

% % Title information
\title{Lenses With a Difference}         %% [Short Title] is optional;
% % when present, will be used in % header instead of Full Title.
% %\titlenote{with title note}             %% \titlenote is optional; % can be
% repeated if necessary; % contents suppressed with 'anonymous'
% %\subtitle{Subtitle}                     %% \subtitle is optional
% %\subtitlenote{with subtitle note}       %% \subtitlenote is optional; % can
% be repeated if necessary; % contents suppressed with 'anonymous'


% % Author information % Contents and number of authors suppressed with
% 'anonymous'.
% % Each author should be introduced by \author, followed by % \authornote
% (optional), \orcid (optional), \affiliation, and % \email.
% % An author may have multiple affiliations and/or emails; repeat the %
% appropriate command.
% % Many elements are not rendered, but should be provided for metadata %
% extraction tools.

% % Author with single affiliation.
%\author{First1 Last1}
%\authornote{with author1 note}          %% \authornote is optional;
% % can be repeated if necessary
%\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional \affiliation{
%\position{Position1}
%\department{Department1}              %% \department is recommended
%\institution{Institution1}            %% \institution is required
%\streetaddress{Street1 Address1}
%\city{City1}
%\state{State1}
%\postcode{Post-Code1}
%\country{Country1}                    %% \country is recommended }
%\email{first1.last1@inst1.edu}          %% \email is recommended

\author{Solomon Maina}
\position{PhD Student}
\department{Computer Science}              %% \department is recommended
\institution{University of Pennsylvania}            %% \institution is required
\country{USA}                    %% \country is recommended }
\email{smaina@seas.upenn.edu}          %% \email is recommended

% % Abstract % Note: \begin{abstract}...\end{abstract} environment must come %
% before \maketitle command
\begin{abstract}
A {\em lens} is a program that can be run in two directions. In the
forward direction, the \get component of a lens produces a {\em view}
from a {\em source}, while in the backward direction, the \pput component folds
an updated view back into the original source. One of the reasons that
lenses are appealing is that they satisfy laws which give guarantees on how the
two transformations interact.

One of these laws requires that the \pput component if a lens returns the
original source unmodified whenever the update to the view is a no-op.
Unfortunately, this (and other) laws do not specify the behaviour of the \pput
component when the update to the view is non-trivial. Consequently, a small
update to the view can result in a large update to the source. For example, if
the source and view are order agnostic, then a lens which updates records
positionally may be valid, even though such a lens may update all the records
in the source when only a single record is added at the beginning of the view.

This paper strengthens the traditional lens laws by adding a law that
constrains the behaviour of the \pput component of a lens even when the update
made to the view is non-trivial. To do this, we will first interprete sources
and views as {\em difference posets} which are posets where we can compute the
difference between any two elements of the poset. With this interpretation, we
will then express the new law which will require that the \pput component of a
lens preserve differences. For example, we will be able to invalidate
positional lenses defined on order agnostic data on the grounds that the \pput
component of positional lenses do not respect order agnostic differences.

\sam{Also we actually need two new laws: one for put and one for create! But
create is often elided from lens papers. Do we need to talk about create in the
abstract?}

\sam{What should an evaluation section for this paper entail?}

\end{abstract}


%% Keywords
%% comma separated list
\keywords{lenses, difference posets}  %% \keywords
% are mandatory in final camera-ready submission


%% \maketitle
%% Note: \maketitle command must come after title commands, author
%% commands, abstract environment, Computing Classification System
%% environment and commands, and keywords command.
\maketitle

\section{Introduction}
TODO
\iffalse
A {\em lens} $\ell$ is a program that can be run in two directions. In the
forward direction, the \get component of $\ell$ produces a {\em view} $v$
from a {\em source} $s$ such as a database. In the backward direction,
the \pput component of $\ell$ folds an updated view $v'$ back into the
original source $s$.

For example suppose that the source is an XML document representing the
names, dates and nationalities of a collection of classical music
composers such as,

\begin{lstlisting}
<composers>
<composer>
<name>Jean Sibelius</name>
<dates>1865-1956</dates>
<nationality>Finnish</nationality>
</composer>
<composer>
<name>Aaron Copland</name>
<dates>1910-1990</dates>
<nationality>American</nationality>
</composer>
<composer>
<name>Benjamin Briten</name>
<dates>1913-1976</dates>
<nationality>English</nationality>
</composer>
</composers>
\end{lstlisting}

while the view is a list if ASCII text representing the names and dates of each
composer:
\begin{lstlisting}
Jean Sibelius, 1865-1956
Aaron Copland, 1910-1990
Benjamin Briten, 1913-1976
\end{lstlisting}

After computing the initial view, we might want to edit it in some way---e.g.,
correcting the error in Sibelius's death date and the misspelling in Britten's
name
\begin{lstlisting}
Jean Sibelius, 1865-|\colorbox{orange}{1957}|
Aaron Copland, 1910-1990
Benjamin |\colorbox{orange}{Britten}|, 1913-1976
\end{lstlisting}
and push the changes back into the original XML format:
\begin{lstlisting}
<composers>
<composer>
<name>Jean Sibelius</name>
<dates>1865-|\colorbox{orange}{1957}|</dates>
<nationality>Finnish</nationality>
</composer>
<composer>
<name>Aaron Copland</name>
<dates>1910-1990</dates>
<nationality>American</nationality>
</composer>
<composer>
<name>Benjamin |\colorbox{orange}{Britten}|</name>
<dates>1913-1976</dates>
<nationality>English</nationality>
</composer>
</composers>
\end{lstlisting}

For traditional lenses, these two transformations---i.e. computing the initial
view from the source and pushing the updated view back into the source---are
required to satisfy two important properties. First, if we \pput a view $v$
back into a source $s$ and the \get a view $v'$ from $s$, then $v' = v$. Second,
if we \get a view $v$ from a source $s$ and then \pput $v$ back into $s$ to \get a
source $s'$, then $s = s'$. These two laws are encapsulated in the equations
\begin{align}
\ell.\get \; (\ell.\pput \; s \; v) &= v \tag{PUTGET}\\
\ell.\pput \; s \; (\ell.\get \; s) &= s \tag{GETPUT}
\end{align}

While these two laws give some guarantees on how the \get and \pput components
of a lens interact, they are not strong enough to guarantee that the
updates made to a view are indeed the updates reflected back into the source.
This is because the GETPUT law only says that the \pput component must return
the original source unmodified whenever the update to the view is a no-op; it
does not say what the \pput component should do with an unmodified view.
Consequently, any non-trivial update to a view can lead to arbitrary update to
the source, or to be more precise, the lens laws do not prohibit such a
situation from occuring.

For example consider a lens $\ell$ whose \get component maps source data in the
form of integer pairs to view data in the form of an integer by simply
discarding the first element of the pair: that is, $\ell.\get (a, b) = b$. Given
a source $(a, b)$ and a view $c$, the \pput component of $\ell$ evaluates to
$(a, c)$ if $b=c$, and otherwise evaluates to $(0, c)$.

It is easy to verify that the PUTGET law and the GETPUT law hold for $\ell$.
However, observe that $\ell.\pput (1, 2) \; 3 = (0,3)$ despite the fact that
intuitively, $\ell$ should never update the first factor of a pair, since the
view does not contain any information about the first factor. In particular,
one would expect that $\ell.\pput (1, 2) \; 3 = (1,3)$, and in general,
$\ell.\pput (a, b) \; c = (a,c)$.
\iffalse
We would like a lens to guarantee that if we produce the view $\ell.\get \; s$
from $s$ and then modify $\ell.\get \; s$ to \get an updated view $v$, then the
changes reflected back into $s$ via $\ell.\pput \; s \; v$ are at most the changes
made to $\ell.\get \; s$ to \get $v$.

This implies that if $v \neq \ell.\get \; s$ and $v' \neq \ell.\get \; s$ are
arbitrary views with $v$ being very similar to $\ell.\get \; s$ and $v'$ being
very different from $\ell.\get \; s$, then $\ell.\pput \; s \; v$ should be very
similar to $s$, whereas $\ell.\pput \; s \; v'$ should be very different from $s$.

However, the GETPUT law only says that
$$\ell.\pput \; s \; (\ell.\get \; s) = s$$
This law nothing about the behaviour of $\ell.\pput$ when it is invoked with a
view different from $\ell.\get \; s$. So we could have $\ell.\pput \; s \; v =
\ell.\pput \; s \; v'$, even though they should be very different.

However, the GETPUT law only says that
$$\ell.\pput \; s \; (\ell.\get \; s) = s$$
This law nothing about the behaviour of $\ell.\pput$ when it is invoked with a
view different from $\ell.\get \; s$. Thus we could have $\ell.\pput \; s \; v$
reflecting changes that are different from the updates made to $\ell.\get \; s$
to acquire $v$, thus corrupting the source $s$.

In the rest of this article, we strengthen the lens laws so that if we produce
an updated view $v$ from $\ell.\get \; s$, then the changes reflected in
$\ell.\pput \; s \; v$ are at most the changes made to $\ell.\get \; s$ that
resulted in the updated view $v$.
\fi
\fi

\section{Difference Posets}
\begin{definition}
A {\em difference poset (DP)} is a triple $(P, \rho, \delta)$ where $P$ is
a poset and $\rho : P \longrightarrow \mathbb{R}^{\geq 0}$ and $\delta : P
\times P \longrightarrow P$ are functions satisfying :
\begin{align}
&\delta(a, b) \leq a\tag{A1}\\
&\text{if } a < a',\text{ then } \rho(a) < \rho(a') \tag{A2}\\
&\text{if } a \leq a' \text{ then for all }b , \; \rho(\delta(b, a)) \geq
\rho(\delta(b, a'))\tag{A3}
\end{align}
We call $\rho$ the weight function of $(P, \rho, \delta)$ and $\delta$ its
difference function.
\end{definition}
\iffalse
Intuitively, $\pi_1(\delta(a, b))$ tells us how much $a$ differs from $a \wedge
b$ while $\pi_2(\delta(a, b))$ tells us how much $b$ differs from $a \wedge b$.
The advantage of the definition of difference functions is that $\delta(a, b)$
is defined even if $a \wedge b$ does not exist. Still it is instructive to
think of $a \wedge b$ to understand what the axioms are saying.

The first law says that the difference between $a$ and $a \wedge b$ is less
than or equal to $a$, and the difference between $b$ and $a \wedge b$
is less than or equal to $b$.

The second law says that the difference between $a$ and $a \wedge b$ is equal
to the difference between $b$ and $a \wedge b$ if and only if $a = b$.

The third law says that switching $a$ and $b$ and then taking the difference
is the same as taking the difference and then switching the components.

The fourth law says that if $a \leq a'$ then the difference between $b$
and $a \wedge b$ is greater than or equal to the difference between $b$ and $a'
\wedge b$.
\fi
\begin{example}\label{embedding}
Let $P$ be any set with equality giving the poset structure. Given any
function $\rho: P \longrightarrow \mathbb{R}^{\geq 0}$ on $P$, and function
$\delta$ defined by $\delta(a, b) = a$, then $(P, \rho, \delta)$ is a difference
poset.
\end{example}
\begin{example}\label{naturalnumbers}
Let $P$ be the poset given by non-negative integers with the order $\leq$ and
weight function $\rho(a) = a$. Define $\delta$ by $\delta(a, b) = \max\{0,
a-b\}$. Then $(P, \rho, \delta)$ is a difference poset.
\end{example}
\begin{example}\label{divisibility}
Let $P$ be the poset given by non-negative integers with the division
relation and weight function $\rho(p_1^{a_1} \cdot \ldots \cdot p_n^{a_n}) =
a_1 + \ldots + a_n$. Define $\delta$ by $\delta(a, b) = a/gcd(a, b)$. Then $(P,
\rho, \delta)$ is a difference poset.
\end{example}
\begin{example}\label{boolean}
Let $X$ be a set and $P$ the poset given by the finite subsets of $2^X$ with the
containment relation and weight function $\rho(A) = |A|$. Define $\delta$
by $\delta(A, B) = A \setminus B$. Then $(P, \rho, \delta)$ is a difference
poset.
\end{example}
\begin{example}\label{general}
Generalizing \cref{divisibility} and \cref{boolean}, let $P$ be a complete
lattice and $\rho$ a strict order preserving map from $P$ to the non-negative
real numbers. Define $$\delta(a, b) = \rho\left(\bigwedge \{x \; | \; (a \wedge
b) \vee x = a\}\right)$$
Then $(P, \rho, \delta)$ is a difference poset.
\end{example}
\begin{proof}
Let $a, a', b \in P$.  Let $X = \{x \; | \; (a \wedge b) \vee x =  a\}$, $Y =
\{y \; | \; (b \wedge a) \vee y = b\}$ and $Y' = \{y' \; | \; (b \wedge a')
\vee y' = b\}$.
\begin{enumerate}
  \item[(A1)]
  Since $a \in X$ and $\delta(a, b) = \bigwedge X$, it follows that
  $\bigwedge X \leq a$.
  \item[(A2)]
  Follows from the fact that $\rho$ is a strict order preserving map from $P$ to
  the non-negative real numbers.
  \item[(A3)]
  Assume that $a \leq a'$. First we show that $Y \subseteq Y'$. Assume that
  $y \in Y$. Since $a \wedge b \leq a' \wedge b \leq b = (a \wedge b) \vee y$,
  it follows that, $(a' \wedge b) \vee y = (a \wedge b) \vee y = b$, hence $y
  \in Y'$. Consequently, $\bigwedge Y \geq \bigwedge Y'$ from which it follows
  that $$\rho(\delta(b, a)) =\rho\left(\bigwedge Y\right) \geq
  \rho\left(\bigwedge Y'\right) = \rho(\delta(b, a'))$$
  This completes the proof.
\end{enumerate}
\end{proof}
\iffalse
Now define a
function $d:
P \longrightarrow \mathbb{R}$ on $P$ by $$d(a, b) =
\begin{cases}
0 & \text{if } a = b\\
\rho(\pi_1(\delta(a, b))) + \rho(\pi_2(\delta(a, b))) & \text{otherwise}
\end{cases}$$
\begin{fact}
\begin{enumerate}
  \item
  $d(a,b) \geq 0$,
  \item
  $d(a, b) = 0$ if and only if $a = b$, and
  \item
  $d(a, b) = d(b, a)$
\end{enumerate}
\end{fact}
\begin{fact}
If $b \leq c$, then for all $b$, $d(a, b) \geq d(a, c)$. Thus if $b \leq c$,
$d(a, c) \leq d(a, b) + d(b, c)$
\end{fact}
\begin{question}
Under what conditions is $d$ a metric?
\end{question}
\fi
\section{New Difference Posets from Old}
Let $(P, \rho, \delta)$ and $(P', \rho', \delta)$ be difference posets.

\subsection{Product of Posets}
Define the product $P \times P'$ of $P$ and $P'$ to be the set $P \times P'$
with $\leq_{P \times P'} = \leq_P \times \leq_{P'}$. Define the weight function
$(\rho \times \rho')$ on $P \times P'$ by $(\rho \times \rho')(a, b) = \rho(a)
+ \rho(b)$. Define the difference function $\delta_P \times \delta_{P'}$ on $P
\times P$ by $$(\delta \times \delta')((a_1, b_1), (a_2, b_2)) = (\delta(a_1,
a_2), \delta(b_1, b_2))$$
\begin{claim}
$(P \times P', \rho \times \rho', \delta \times \delta)$ is a difference poset.
\end{claim}
\begin{proof}
We check that the definition that each of the axioms for a difference poset
holds.
\begin{enumerate}
  \item[(A1)]
  Since $\delta$ and $\delta'$ are difference functions, then $\delta(a_1, a_2)
  \leq a_1$ and $\delta'(b_1, b_2) \leq b_1$, hence $$
  (\delta \times \delta')((a_1, b_1), (a_2, b_2)) = (\delta(a_1, a_2),
  \delta(b_1, b_2)) \leq (a_1, b_1)$$
  \item[(A2)]
  Assume that $(a_1, b_1) < (a_2, b_2)$. Then since $\rho$ and $\rho'$ are
  weight functions, it follows that $\rho(a_1) < \rho(a_2)$ and
  $\rho'(b_1) < \rho'(b_2)$. Consequently,
  $$(\rho \times \rho')(a_1, b_1) = \rho(a_1) + \rho(b_1) < \rho(a_2) +
  \rho(b_2) = (\rho \times \rho)(a_2, b_2)$$
  \item[(A3)]
  Assume that $(a_1, b_1) \leq (a_2, b_2)$. Then since $\delta$ and $\delta'$ are
  difference functions, it follows that $\rho(\delta(a_3, b_1))
  \geq \rho(\delta(a_3, b_2))$ and $\rho'(\delta'(b_3, b_1)) \geq
  \rho'(\delta'(b_3, b_2))$.
  Consequently,
  \begin{align*}
((\rho \times \rho') \circ (\delta \times \delta'))((a_3, b_3), (a_1, b_1)))
&= (\rho \times \rho')(\delta(a_3, a_1), \delta'(b_3, b_1))\\
&= \rho(\delta(a_3, a_1)) + \rho'(\delta(b_3, b_1))\\
&\geq \rho(\delta(a_3, a_2)) + \rho'(\delta(b_3, b_2))\\
&= (\rho \times \rho')(\delta(a_3, a_2), \delta'(b_3, b_2))\\
&= ((\rho \times \rho') \circ (\delta \times \delta'))((a_3, b_3), (a_2,
b_2))\end{align*}

This completes the proof.
\end{enumerate}
\end{proof}
\subsection{Coproduct of Posets}
Define the coproduct $P \sqcup P'$ of $P$ and $P'$ to be the set $P \sqcup P'$
(disjoint union of $P$ and $P'$) with $x \leq_{P \sqcup P'} y$ if and only if
$x \leq_P y$ or $x \leq_{P'} y$. Define the weight function
$(\rho \sqcup \rho')$ on $P \sqcup P'$ by
$$(\rho \sqcup \rho')(a) =
\begin{cases}
\rho(a) &\text{if }a \in P\\
\rho'(a) &\text{if }b \in P
\end{cases}$$
Define the difference function $\delta_P \sqcup \delta_{P'}$ on $P \sqcup P'$ by
$$(\delta \sqcup \delta')(a, b) =
\begin{cases}
\delta(a, b) &\text{if }a, b \in P\\
\delta'(a, b) &\text{if }a, b \in P'\\
a & \text{otherwise}
\end{cases}$$
\begin{claim}\label{coproductdifference}
$(P \sqcup P', \rho \sqcup \rho', \delta \sqcup \delta')$ is a difference poset.
\end{claim}
\begin{proof}
We check that $\delta_P \sqcup \delta_{P'}$ satisfies the axioms for difference
functions.
\begin{enumerate}
  \item[(A1)]
  If $x, y \in P$ then $(\delta \sqcup \delta')(x, y) = \delta(x, y) \leq x$.
  A similar argument shows the same result if $x, y \in P'$. Otherwise $\delta
  \sqcup \delta'(a, b) = a$.
  \item[(A2)]
  Assume that $a \leq_{P \sqcup P'} b$. If $a \leq_P b$,
  $$(\rho \sqcup \rho')(a) = \rho(a) < \rho(b) = (\rho \sqcup \rho')(b)$$
  If $a \leq_{P'} b$, then
  $$(\rho \sqcup \rho')(a) = \rho'(a) < \rho'(b) = (\rho \sqcup \rho')(b)$$
  \item[(A3)]
  Assume that $a \leq_{P \sqcup P'} b$. Assume first that $a \leq_P b$. If $c
  \in P$, then $\rho(\delta(c, a)) \geq \rho(\delta(c, a'))$ since $\delta$ is a
  difference function. If $c \in P'$, then $\delta(c, a) = \delta(c, b) = c$,
  hence $\rho(\delta(c, a)) \geq \rho(\delta(c, a))$. A similar argument shows
  that if $a \leq_{P'} b$, then for all $c \in P \sqcup P'$, $\rho(\delta(c, a))
  \geq \rho(\delta(c, a'))$. This completes the proof.
\end{enumerate}
\end{proof}
\subsection{List Posets}
Assume that $\rho > 0$. Define the list poset $P^*$ of $P$ to be the set
$$P^0 \sqcup P \sqcup (P \times P) \sqcup \ldots \sqcup P^i \sqcup \ldots$$
This is just the set of all finite sequences of elements on $P$, with $P^0 =
\epsilon$, the empty sequence. The poset structure on $P^*$ is the poset
structure inherited from the product and coproduct constructions. Define the
weight function $\rho^*$ on $P^*$ by $\rho((x_1, \ldots, x_m)) = \rho(x_1) +
\ldots + \rho(x_m)$. Define the difference function $\delta^*$ on $P^*$ by
$$\delta^*(a, b) =
\begin{cases}
\delta^i(a, b) &\text{if }a, b \in P^i\\
a & \text{otherwise}
\end{cases}$$
\begin{claim}
$(P^*, \rho^*, \delta^*)$ is difference poset.
\end{claim}
\begin{proof}
Proceed as in the proof of \cref{coproductdifference}.
\end{proof}
\subsubsection{A Finer Poset Structure on $P^*$}
Define a finer poset structure on $P^*$ by $x \; \leq \; y$
if and only if $x = (x_1, \ldots, x_m), \; y = (y_1, \ldots, y_n)$, $m \leq n$
and $x_i \leq y_i$ for $1 \leq i \leq m$. Now let $m, n$ be any non-negative
integers and let $k = \min\{m, n\}$. We define the difference function
$\Delta^*$ on $P^*$ by 
$$\Delta^*((x_1, \ldots, x_m), (y_1, \ldots, y_n)) = ((\delta(x_1, y_1), \ldots,
\delta(x_k, y_k), x_{k+1}, \ldots, x_m)$$
\begin{claim}
$(P^*, \rho^*, \Delta^*)$ is a difference poset.
\end{claim}
\begin{proof}
We check that each of the axioms for a difference poset holds.
\begin{enumerate}
  \item[(A1)]
  Since $\delta$ is a difference function, $\delta(x_i, y_i)
  \leq x_i$ for $1 \leq i \leq \min\{m, n\}$, from which it follows that
  $\Delta^*((x_1, \ldots, x_m), (y_1, \ldots, y_n)) \leq (x_1, \ldots, x_m)$
  \item[(A2)]
  Assume that $(x_1, \ldots, x_m) < (y_1, \ldots, y_n)$. Then $m \leq
  n$ and $\rho(x_k) < \rho(y_k)$ for some $1 \leq k \leq m$ and $\rho(x_i)
  \leq \rho(y_i)$ for all $1 \leq i \leq m$, from which it follows that
  $$\rho^*(x_1, \ldots, x_m) = \sum_{i=1}^m \rho(x_i) < \sum_{i=1}^{n}\rho(y_i)
  = \rho^*(y_1, \ldots, y_n)$$
  \item[(A3)]
  Assume that $(x_1, \ldots, x_m) \leq (y_1, \ldots, y_{m'})$. Then $m \leq
  m'$ and $x_i \leq y_i$ for $1 \leq i \leq m$. Let $k = \min\{m, n\}$ and $k' =
  \min\{m', n\}$. By the definition of $\Delta^*$,
  \begin{align*}
\Delta^*((z_1, \ldots, z_n), (x_1, \ldots, x_m)) &= (\delta(z_1, x_1),
\delta(z_k, x_k), z_{k+1}, \ldots, z_n)\\
\Delta^*((z_1, \ldots, z_n), (y_1, \ldots, y_{m'})) &= (\delta(z_1, y_1),
\delta(z_k, y_{k'}), z_{k'+1}, \ldots, z_n)
\end{align*}
As $\delta$ is a difference function, it follows that $\delta(z_i, x_i) \geq
\delta(z_i, y_i)$ for $1 \leq i \leq k$, hence
$$\Delta^*((z_1, \ldots, z_n), (x_1, \ldots, x_m)) \geq \Delta^*((z_1,
\ldots, z_n), (y_1, \ldots, y_{m'}))$$
This completes the proof.
\end{enumerate}
\end{proof}

\subsubsection{An Even Finer Poset Structure on $P^*$}\label{nocrossing}
Define a finer poset structure on $P^*$ by $x \leq y$ if
and only if $x = (x_1, \ldots, x_m), \; y = (y_1, \ldots, y_n)$, $m \leq n$ and
there exists an increasing injective function $\varphi : [m] \longrightarrow
[n]$ such that $x_i \leq y_{\varphi(i)}$ for $1 \leq i \leq m$.

Now let $x = (x_1, \ldots, x_m), \; y = (y_1, \ldots, y_n)$. We define the
function $\Gamma^*$ on $P^*$ by taking the difference of $x_i$ and
$y_{\varphi(i)}$ for some ``maximal'' increasing injective function $\varphi :
A \longrightarrow [n]$ where $A$ is a subset of $[m]$, except that we eliminate
all $x_i$ where $x_i = y_{\varphi(i)}$.

For example, assume that $P$ is the set consisting of the letters of the
alphabet where the poset structure is given by equality, with $\rho(a) = 1$
and $\delta(a, b) = a$ for all $a, b \in P$. Then $\Gamma^*((a, c, d, f, b, e),
(a, b, d, e)) = (c, f, b)$ where we eliminate $a$, $d$ and $e$ from the first
sequence. However, even though $b$ occurs in both sequences, we are not allowed
to eliminate both $b$ and $d$ since these two characters occur in the order $d,
b$ in the first sequence and in the order $b, d$ in the second sequence. If we
were to eliminate both of them, then the matching would have to have a
crossing, thus contradicting the monotonicity of $\varphi$.

Given any increasing injective $\varphi : A \longrightarrow [n]$ for some
subset $A$ of $[m]$, define $\Gamma^*_{\varphi}(x, y)$ to be the difference
between $x$ and $y$ computed using $\varphi$. Then the maximal $\varphi$ is the
$\varphi$ that minimizes $\rho^*(\Gamma^*_{\varphi}(x, y))$. If there are
multiple such $\varphi$, we choose the one that maximizes $|A|$. If there are
still multiple such $\varphi$, we choose the one for which $A$ is
lexicographically minimal.
\begin{claim}\label{nocrossingproof}
$(P^*, \rho^*, \Gamma^*)$ is a difference poset.
\end{claim}
\begin{proof}
Let $x = (x_1, \ldots, x_m)$, $y = (y_1, \ldots, y_n)$ and $z = (z_1, \ldots,
z_k)$. We check that each of the axioms for a difference poset holds.
\begin{enumerate}
  \item[(A1)]
  Since each element of $\Gamma^*(x, y)$ is either equal to $\Gamma(x_i,
  y_{\varphi(i)})$ for some $\varphi$, or to $x_j$ for some $j$, and since these
  elements occur in increasing order, it follows that $\Gamma^*(x, y) \leq x$.
  \item[(A2)]
  Assume that $(x_1, \ldots, x_m) < (y_1, \ldots, y_n)$. Then $m \leq
  n$ and there exists an increasing injective function $\varphi:[m]
  \longrightarrow [n]$ such that $\rho(x_k) < \rho(y_{\varphi(k)})$ for some $1
  \leq k \leq m$ and $\rho(x_i) \leq \rho(y_{\varphi(i)})$ for all $1 \leq i
  \leq m$. It thus follows that $$\rho^*(x_1, \ldots, x_m) = \sum_{i=1}^m
  \rho(x_i) < \sum_{i=1}^{n}\rho(y_i) = \rho^*(y_1, \ldots, y_n)$$
  \item[(A3)]
  Assume that $(x_1, \ldots, x_m) \leq (y_1, \ldots, y_n)$. Assume that
  $\Gamma^*(z, x) = \Gamma^*_{\varphi}(z, x)$ for some $\varphi$. Then
  $\rho^*(\Gamma^*_{\varphi} (z, x)) \geq \rho^*(\Gamma^*_{\varphi}(z, y))$
  since $\Gamma$ is a difference function by assumption. Consequently
  $\rho^*(\Gamma^*_{\varphi} (z, x)) \geq \rho^*(\Gamma^*_{\varphi}(z, y)) \geq
  \rho^*(\Gamma^*(z, y))$ since $\Gamma^*(z, y)$ is computed using a $\psi$ that
  minimizes the quantity $\rho^*(\Gamma^*_{\psi}(z, y))$. This completes the
  proof.
\end{enumerate}
\end{proof}
\subsubsection{Quotienting $P^*$ to Ignore Order}
We may try to define an even finer poset structure on $P^*$ by $x \leq y$ if and
only if $x = (x_1, \ldots, x_m), \; y = (y_1, \ldots, y_n)$, $m \leq n$ and
there exists an injective function $\varphi : [m] \longrightarrow [n]$ such
that $x_i \leq y_{\varphi(i)}$ for $1 \leq i \leq m$: we drop the requirement
that $\varphi$ be increasing.

With this poset structure, $(x_{\varphi(1)}, \ldots, x_{\varphi(n)}) \leq
(x_{\psi(1)}, \ldots, x_{\psi(n)})$ for all permutations
$\varphi, \psi$ of $[n]$. The poset axioms thus force us to identify
$(x_{\varphi(1)}, \ldots, x_{\varphi(n)})$ and $(x_{\psi(1)}, \ldots,
x_{\psi(n)})$ for all $\varphi, \psi$. Thus we need to formalize the notion of
{\em quotient posets}.

\begin{definition}
Let $P$ be a poset and let $\sim$ be an equivalence relation on $P$. Define the
quotient $P/{\sim}$ to be the set of equivalence classes with the binary
relation $\leq$ defined by $[x] \leq [y]$ if and only if $x' \leq y'$ for some
$x' \in [x]$ and $y' \in y$
\end{definition}
The quotient $P/{\sim}$ in general is not a poset. For example, take a
3-element chain and identify the bottom and top elements. The relation you
obtain is reflexive and transitive, but not antisymmetric. However, the
following claim gives a condition that guarantees that $P/{\sim}$ is indeed a
poset.

\begin{claim}\label{quotientposet}
Assume that $P$ is a poset and $\rho$ is a strict order preserving map from $P$
to the non-negative real numbers. Let $\sim$ be an equivalence relation on $P$.
Assume that if $x \sim x'$ then $\rho(x) = \rho(x')$. Further, assume that if
$[x] \leq [y]$, then for all $x' \in [x]$ there is a $y' \in y$ such that $x'
\leq y'$. Then $P/{\sim}$ is a poset, and $\rho$ induced on $P/{\sim}$ is a
a strict order preserving map from $P/{\sim}$ to the non-negative real numbers.
\end{claim}
\begin{proof}
Certainly $\leq$ is reflexive in $P/{\sim}$.

To prove transitivity, assume that $[x] \leq [y]$ and $[y] \leq [z]$. Then
there exist $x' \in [x]$, $y' \in [y]$ such that $x' \leq y'$. Since $[y] \leq
[z]$, then by assumption, there exists a $z' \in [z]$ such that $y' \leq z'$.
Consequently, $x' \leq y' \leq z'$, thus $[x] \leq [z]$.

Finally, to prove antisymmetry, assume that $[x] \leq [y]$ and $[y] \leq [x]$.
Then there exist $x', x'' \in [x]$ and $y', y'' \in [y]$ such that $x' \leq y'$
and $y'' \leq x''$. Assume for a contradiction that $[x] \neq [y]$. Since $\sim$
is an equivalence relation, $[x]$ and $[y]$ are disjoint. Consequently $x' <
y'$ and $y'' < x''$. By assumption, $\rho(x') = \rho(x)$ for all $x' \in [x]$
and $\rho(y') = \rho(y)$ for all $y' \in [y]$. As $\rho$ is strict, then
$\rho(x) = \rho(x') < \rho(y') = \rho(y)$ on the one hand, but on the other
hand, $\rho(y) = \rho(y'') < \rho(x'') = \rho(x)$, a contradiction. Thus $[x] =
[y]$.

Thus $P/{\sim}$ is a poset, and the assumption that $\rho(x) = \rho(x')$
if $x \sim x'$ assures us that $\rho$ induced on $P/{\sim}$ is a
a strict order preserving map from $P/{\sim}$ to the non-negative real numbers.
\end{proof}

Recall that we wished to define an even finer poset structure on $P^*$ by $x
\leq y$ if and only if $x = (x_1, \ldots, x_m), \; y = (y_1, \ldots, y_n)$, $m
\leq n$ and there exists an injective function $\varphi : [m] \longrightarrow
[n]$ such that $x_i \leq y_{\varphi(i)}$ for $1 \leq i \leq m$. We observed
that with this finer poset structure on $P^*$, we need to identify
$(x_{\varphi(1)}, \ldots, x_{\varphi(n)})$ and $(x_{\psi(1)}, \ldots,
x_{\psi(n)})$ for all permutations $\varphi$ and $\psi$. In other words we take
the poset structure $\leq_{NC}$ (NC for non-crossing) described in
\cref{nocrossing} and quotient $P^*$ by the equivalence relation which
identifies $(x_{\varphi(1)}, \ldots, x_{\varphi(n)})$ and $(x_{\psi(1)},
\ldots, x_{\psi(n)})$ for all permutations $\varphi$ and $\psi$

In order to confirm that $P^*/{\sim}$ is indeed a poset, then we show that the
hypotheses of \cref{quotientposet} apply to $P^*/{\sim}$. Let $x=(x_1, \ldots,
x_m)$ and $y = (y_1, \ldots, y_n)$. First, we observe that we only identify
$(x_{\varphi(1)}, \ldots, x_{\varphi(n)})$ and $(x_{\psi(1)}, \ldots,
x_{\psi(n)})$ for all permutations $\varphi$ and $\psi$, hence if $x \sim x'$,
then $\rho^*(x) = \rho^*(x')$. Next, we need to show that if $[x] \leq_{NC}
[y]$, then for all $x'' \in [x]$ there is a $y'' \in y$ such that $x''
\leq_{NC} y''$.

Assume that $[x] \leq_{NC} [y]$. Then by the definition of $\leq_{NC}$ and
$\sim$, there exists a permutation $\varphi$ of $[m]$ and a permutation
$\psi$ of $[n]$ such that $(x_{\varphi(1)}, \ldots, x_{\varphi(m)}) \leq_{NC}
(y_{\psi(1)}, \ldots, y_{\psi(n)})$.  Let $x'' = (x_{\theta(1)}, \ldots,
x_{\theta(m)})$ for some permutation of $[m]$. We need to show that there
exists a permutation $\pi$ of $[n]$ such that $(x_{\theta(1)}, \ldots,
x_{\theta(m)}) \leq_{NC} (y_{\pi(1)}, \ldots, y_{\pi(n)})$, but this follows
from a graphical argument; just permute the $y_i$'s to remove crossings.
Therefore, $P^*/{\sim}$ is a poset, and $\rho$ induced on $P/{\sim}$ is a
a strict order preserving map from $P/{\sim}$ to the non-negative real numbers.

We define the difference function $\Gamma^*/{\sim}$ on $P/{\sim}$ by taking
the matching which minimizes $\rho^*$ on the difference as in the non-crossing
case. If there are multiple matchings we just pick one! As in the non-crossing
case, we define $\Gamma^*/{\sim}$ on $P^*/{\sim}$ by eliminating all $x_i$ from
$x$ where $x_i = y_{\varphi(i)}$ and $\varphi$ is the canonical maximal
matching. Going back to our previous example, then $ \Gamma^*([(a, c, d, f, b,
e)], [(a, b, d, e)]) = [(c, f)]$ where we now can eliminate $a, b, d$ and $e$
from the first sequence.
\begin{claim}
$\Gamma^*/{\sim}$ is a difference function.
\end{claim}
\begin{proof}
Proceed as in the proof of \cref{nocrossingproof}.
\end{proof}
\section{Lenses}
\begin{definition}
Let $S, V$ be difference posets. A lens $\ell : S \Leftrightarrow V$ is a
3-tuple of functions
\begin{align*}
\ell.\get &: S \longrightarrow V\\
\ell.\pput &: S \longrightarrow V \longrightarrow S\\
\ell.\create &: V \longrightarrow S
\end{align*}
obeying the following laws for every $s \in S$ and $v \in V$:
\begin{align*}
\ell.\get \; (\ell.\pput \; s \; v) &= v \tag{PUTGET}\\
\ell.\get \; (\ell.\create \; v) &= v \tag{CREATEGET}\\
\ell.\pput \; s \; (\ell.\get \; s) &= s \tag{GETPUT}\\
\delta_S(\ell.\pput \; s \; v, s) &= \ell.\pput \; s \; (\delta_V(v, \ell.\get \; s))
\tag{PUTEXACT}\\
\delta_S(\ell.\create \; v, s) &= \ell.\create \; (\delta_V(v,
\ell.\get \; s))
\tag{CREATEEXACT}
\end{align*}
\end{definition}
These laws are the same as the classical lens laws except for new EXACT rule,
which says that $\ell.\pput$ and $\ell.\create$ preserve differences.

Every classical lens can be made into a lens by taking the poset structure on
$S$ and $V$ to be given by equality with arbitrary weight functions, and
difference functions $\delta$ given by $\delta(a, b) = a$ as in
\cref{embedding}.
\subsection{Boomerang Lens Combinators}
\subsubsection{Copy}
Let $(P, \rho, \delta)$ be any difference poset. Define the $\ccopy : P
\Leftrightarrow P$ by
\begin{align}
\ccopy.\get \; s &= s\\
\ccopy.\pput \; s \; v &= v\\
\ccopy.\create \; v &= v
\end{align}
\begin{claim}
\ccopy is a valid lens.
\end{claim}
\begin{proof}
First, we need to show that $\delta(\ccopy.\pput \; s \;v, s) = \ccopy.\pput \;
s \; (\delta(v, \ccopy.\get \; s))$, and this follows from the fact that
$$\delta(\ccopy.\pput \; s \;v, s) = \delta(v, s) = \delta(v, \ccopy.\get \;s)
= \ccopy.\pput \; s \; (\delta(v, \ccopy.\get \; s))
$$
Next, we need to show that $\delta(\ccopy.\create \;v, s) = \ccopy.\create \;
(\delta(v, \ccopy.\get \; s))$
\end{proof}

\subsubsection{Constant}
Let $P$ be any weighted poset with difference function $\delta(a, b) = a$.
Let $\{*\}$ be a one element weighted poset. Let $p \in P$. Define the \const
lens $\const : P \Leftrightarrow \{*\}$ by
\begin{align*}
\const.\get \; s &= *\\
\const.\pput \; s \; v &= s\\
\const.\create \; v &= p
\end{align*}
\begin{claim}
\const is a valid lens.
\end{claim}
\begin{proof}
First, we need to show that $\delta(\const.\pput \; s \;v, s) = \delta(v,
\const.\get \; s)$, and this follows from the fact that
$$\delta(\const.\pput \; s \;v, s) =
\delta(s, s) = s = \const.\pput \; s \; (\delta(v, v)) = \const.\pput \; s
\; (\delta(v, \const.\get \;s)) $$

Next, we need to show that $\delta(\const.\create \;v, s) =
\const.\create \; \delta(v, \const.\get \; s)$, and this follows from the fact
that
$$\delta(\const.\create \;v, s) = \delta(p, s) = p = \const.\create \; \delta(v,
\const.\get \; s)$$
\end{proof}
\subsubsection{Default}
Let $\ell : S \longrightarrow V$ be a lens. Let $f : V \longrightarrow S$ be any
function. Define the lens $\default(\ell) : V \Leftrightarrow S$ by
\begin{align*}
\default(\ell).\get \; s &= \ell.\get \; s\\
\default(\ell).\pput \; s \; v &= \ell.\pput \; s \; v\\
\default(\ell).\create \; v &= \ell.\pput \; (f \; v) \; v
\end{align*}
\begin{proof}
We need to show that
$$\delta(\default.\create \; v, s) = \default.\create \; s \; (\delta(v,
\ell.\get \; s))$$
and this follows from the fact that 
$$\delta(\default.\create \; v, s) = \delta(\ell.\pput \; (f \; v), s) =
\ell.\pput \; (f \; v) \; (\delta(v, \ell.\get \; s)) = \default.\create \; s
\; (\delta(v, \ell.\get \; s))$$
\end{proof}
\subsubsection{Product}
Let $\ell_1 : S_1 \Leftrightarrow V_1$ and $\ell_2 : S_2 \Leftrightarrow V_2$ be
lenses. Define the lens $\ell_1 \times \ell_2 : (S_1 \times S_2) \Leftrightarrow
(V_1 \times V_2)$ by
\begin{align*}
(\ell_1 \times \ell_2).\get \; (s_1, s_2) &= (\ell_1.\get \; s_1, \ell_2.\get
\; s_1)\\
(\ell_1 \times \ell_2).\pput \; (s_1, s_2) \; (v_1, v_2) &= (\ell_1.\pput \; s_1
\; v_1, \ell_2.\pput \; s_2 \; v_2)\\
(\ell_1 \times \ell_2).\create \; (v_1, v_2) &= (\ell_1.\create \; v_1,
\ell_2.\create \; v_2)
\end{align*}
\begin{claim}
$\ell_1 \times \ell_2$ is a valid lens.
\end{claim}
\begin{proof}
First, we need to show that
$$\delta((\ell_1 \times \ell_2).\pput \; (s_1, s_2) \; (v_1, v_2), (s_1, s_2)) =
(\ell_1 \times \ell_2).\pput \; (s_1, s_2) \; \delta((v_1, v_2), (\ell_1 \times
\ell_2).\get (s_1, s_2))$$ This follows from the fact that
\begin{align*}
\delta((\ell_1 \times \ell_2).\pput \; (s_1, s_2) \; (v_1, v_2), (s_1, s_2)) &=
\delta((\ell_1.\pput \; s_1\; v_1, \ell_2.\pput \; s_2 \; v_2), (s_1, s_2))\\
&= (\delta (\ell_1.\pput \; s_1\; v_1, s_1), \delta (\ell_2.\pput \; s_2 \;
v_2, s_1))\\
&= (\ell_1.\pput \; s_1\; (\delta(v_1, \ell_1.\get \; s_1)), \ell_2.\pput
\; s_2\; (\delta(v_2, \ell_1.\get \; s_2)))\\
&= (\ell_1 \times \ell_2).\pput \; (s_1, s_2) \; (\delta(v_1, \ell_1.\get \;
s_1), \delta(v_2, \ell_1.\get \; s_2))\\
&= (\ell_1 \times \ell_2).\pput \; (s_1, s_2) \; \delta((v_1, v_2), (\ell_1.\get
\; s_1, \ell_2.\get s_2))\\
&= (\ell_1 \times \ell_2).\pput \; (s_1, s_2) \; \delta((v_1, v_2), (\ell_1
\times \ell_2).\get (s_1, s_2))
\end{align*}
Next, we need to show that
$$\delta((\ell_1 \times \ell_2).\create \; (v_1, v_2), (s_1, s_2))
= (\ell_1 \times \ell_2).\create \; \delta((v_1, v_2), (\ell_1
\times \ell_2).\get (s_1, s_2))$$
which follows from the fact that
\begin{align*}
\delta((\ell_1 \times \ell_2).\create \; (v_1, v_2), (s_1, s_2)) &=
\delta((\ell_1.\create \; v_1, \ell_2.\create \; v_2), (s_1, s_2))\\
&= (\delta(\ell_1.\create \; v_1, s_1), \delta(\ell_2.\create \; v_2, s_2))\\
&= (\ell_1.\create \; (\delta(v_1, \ell_1.\get \; s_1)), \ell_2.\create \;
(\delta(v_2, \ell_2.\get \; s_2)))\\
&= (\ell_1 \times \ell_2).\create \; ((\delta(v_1, \ell_1.\get \; s_1)),
(\delta(v_2, \ell_2.\get \; s_2)))\\
&= (\ell_1 \times \ell_2).\create \; \delta((v_1, v_2), (\ell_1.\get \;
s_1, \ell_2.\get \; s_2))\\
&= (\ell_1 \times \ell_2).\create \; \delta((v_1, v_2), (\ell_1
\times \ell_2).\get (s_1, s_2))
\end{align*}
\end{proof}
\subsubsection{Sum}
Let $\ell_1 : S_1 \Leftrightarrow V_1$ and $\ell_2 : S_2 \Leftrightarrow V_2$ be
lenses. Define the lens $\ell_1 \sqcup \ell_2 : (S_1 \sqcup S_2) \Leftrightarrow
(V_1 \sqcup V_2)$ by
\begin{align*}
(\ell_1 \sqcup \ell_2).\get \; s &= 
\begin{cases}
\ell_1.\get \; s & \text{if } s \in S_1\\
\ell_2.\get \; s & \text{if } s \in S_2\\
\end{cases}\\
(\ell_1 \sqcup \ell_2).\pput \; s \; v&= 
\begin{cases}
\ell_1.\pput \; s \; v& \text{if } s \in S_1, \; v \in V_1\\
\ell_2.\pput \; s \; v& \text{if } s \in S_2, \; v \in V_2\\
\ell_1.\create \; v & \text{if } s \in S_2, \; v \in V_1\\
\ell_2.\create \; v & \text{if } s \in S_1, \; v \in V_2\\
\end{cases}\\
(\ell_1 \sqcup \ell_2).\create \; v &= 
\begin{cases}
\ell_1.\create \; v & \text{if } v \in V_1\\
\ell_2.\create \; v & \text{if } v \in V_2\\
\end{cases}
\end{align*}
\begin{claim}
$\ell_1 \sqcup \ell_2$ is a valid lens.
\end{claim}
\begin{proof}
We need to show that
$$\delta((\ell_1 \sqcup \ell_2).\pput \; s \; v, s) = (\ell_1 \sqcup
\ell_2).\pput \; s \; \delta(v, (\ell_1 \sqcup \ell_2).\get \; s)$$

In the first case, assume that $s \in S_1$, $v \in V_1$. Then we need to show
that $$\delta(\ell_1.\pput \; s \; v, s) = \ell_1.\pput \; s \; \delta(v,
\ell_1.\get \; s)$$
which follows from the fact that $\ell_1$ is a lens. A similar proof gives the
same result if $s \in S_2$ and $v \in v_2$.

Now assume that $s \in S_1$ and $v \in V_2$. Then we need to show
that 
$$\delta(\ell_2.\create \; v, s) = \ell_2.\create \; (\delta(v, \ell_2.\get \;
s))$$ which follows from the fact that $\ell_2$ is a lens. A similar proof gives
the same result if $s \in S_2$ and $v \in V_1$. This completes the proof.
\end{proof}
\subsubsection{Iteration}
Let $\ell: S \Leftrightarrow V$ be a lens. Define the lens $\ell^*: S
\Leftrightarrow V$ by
\begin{align*}
\ell^* .\get \; (s_1, \ldots, s_n) &= (\ell.\get \; s_1) \cdot \ldots \cdot
(\ell.\get \; s_n)\\
\ell^* .\pput \; (s_1, \ldots, s_m) \; (v_1, \ldots, v_n) &= s'_1 \cdot \ldots
\cdot s'_n\\
\text{ where } s'_i &= \begin{cases}
\ell.\pput \; s_i \; v_i & \text{if } 1 \leq i \leq \min\{m, n\}\\
\ell.\create \; v_i & \text{if } \min\{m, n\} < i \leq n
\end{cases}\\
\ell^*.\create \; (v_1, \ldots, v_n) &= (\ell.\create \; v_1) \cdot \ldots \cdot
(\ell.\create \; v_n)
\end{align*}
\begin{claim}
$\ell_1 \times \ell_2$ is a valid lens.
\end{claim}
\begin{proof}
First, we need to show that
\begin{multline}\label{positionalputexact}
\delta(\ell^*.\pput \; (s_1, \ldots, s_n) \; (v_1, \ldots, v_m),
(s_1, \ldots, s_n)) = \\ \ell^*.\pput \; (s_1, \ldots, s_n) \; \delta((v_1,
\ldots, v_m), \ell^*.\get \; (s_1, \ldots, s_n))
\end{multline}
Now
\begin{align*}
\ell^* .\pput \; (s_1, \ldots, s_m) \; (v_1, \ldots, v_n) &= s'_1 \cdot \ldots
\cdot s'_n\\
\text{ where } s'_i &= \begin{cases}
\ell.\pput \; s_i \; v_i & \text{if } 1 \leq i \leq \min\{m, n\}\\
\ell.\create \; v_i & \text{if } \min\{m, n\} < i \leq n
\end{cases}\\
\end{align*}
hence
\begin{align*}
\delta(\ell^* .\pput \; (s_1, \ldots, s_m) \; (v_1, \ldots, v_n)) &= s'_1 \cdot
\ldots \cdot s'_n\\
\text{ where } s'_i &= \begin{cases}
\delta(\ell.\pput \; s_i \; v_i) & \text{if } 1 \leq i \leq \min\{m, n\}\\
\delta(\ell.\create \; v_i) & \text{if } \min\{m, n\} < i \leq n
\end{cases}\\
\end{align*}
Since $\delta$ is a difference function, then
\begin{align*}
\delta(\ell^* .\pput \; (s_1, \ldots, s_m) \; (v_1, \ldots, v_n)) &= s'_1 \cdot
\ldots \cdot s'_n\\
\text{ where } s'_i &= \begin{cases}
\ell.\pput \; s_i \; \delta(v_i, \ell.\get \; s_i) & \text{if } 1 \leq i \leq
\min\{m, n\}\\
\ell.\create \; \delta(v_i, \ell.\get \; s_i) & \text{if } \min\{m, n\} < i \leq
n \end{cases}\\
\end{align*}
Now since
\begin{equation}\label{expanddelta^n}
\delta((v_1, \ldots, v_m), \ell^*.\get \; (s_1, \ldots, s_n)) = 
\delta(v_1, \ell.\get \; s_1) \cdot \ldots \cdot \delta((v_n, \ell.\get \; s_n))
\end{equation}
then
\begin{multline}
\ell^*.\pput \; (s_1, \ldots, s_n) \; \delta((v_1,
\ldots, v_m), \ell^*.\get \; (s_1, \ldots, s_n)) = \\
\ell^*.\pput \; (s_1, \ldots, s_n) \; \delta(v_1, \ell.\get \; s_1) \cdot
\ldots \cdot \delta((v_n, \ell.\get \; s_n))
\end{multline}

\end{proof}
\subsubsection{Composition}
Let $S, U, V$ be weighted posets. Let $\ell_1 : S \Leftrightarrow U$ and $\ell_2
: U \Leftrightarrow V$ be lenses. To show that $\ell_2 \circ \ell_1$ is also a
lens, we need to show that $\ell_2 \circ \ell_1$ satisfies the EXACT law:
\begin{multline}\label{composeresult}
\delta_S(\ell_1.\pput \; s \; (\ell_2.\pput \; (\ell_1.\get \; s) \; v), s) =
\ell_1.\pput \; s \; (\ell_2.\pput \; (\ell_1.\get \; s) \; (\delta_V(v, \ell_2.\get
\; (\ell_1.\get \; s))))
\end{multline}
Since $\ell_1$ and $\ell_2$ are lenses, then for all $s \in S$, $u \in U$ and $v
\in V$, we have
\begin{equation}\label{compose1}
\delta_S(\ell_1.\pput \; s \; u, s) = \ell_1.\pput \; s \; (\delta_U(u, \ell_1.\get
\; s))
\end{equation}
and
\begin{equation}\label{compose2}
\delta_U(\ell_2.\pput \; u \; v, u) = \ell_2.\pput \; u \; (\delta_V(v, \ell_2.\get
\; u))
\end{equation}

\noindent Substituting $\ell_2.\pput \; (\ell_1.\get \; s) \; v$ for $u$ in
\cref{compose1} and $\ell_1.\get \; s$ for $u$ in \cref{compose2} we \get
\begin{equation}\label{compose1subst}
\delta_S(\ell_1.\pput \; s \; (\ell_2.\pput \; (\ell_1.\get \; s) \; v), s) =
\ell_1.\pput \; s \; (\delta_U(\ell_2.\pput \; (\ell_1.\get \; s) \; v, \ell_1.\get
\; s))
\end{equation}
and
\begin{equation}\label{compose2subst}
\delta_U(\ell_2.\pput \; (\ell_1.\get \; s) \; v, (\ell_1.\get \; s)) = \ell_2.\pput
\; (\ell_1.\get \; s) \; (\delta_V(v, \ell_2.\get \; (\ell_1.\get \; s)))
\end{equation}
Applying $(\ell_1.\pput \; s)$ to \cref{compose2subst} we \get
\begin{equation}\label{compose3subst}
\ell_1. \pput \; s \; (\delta_U(\ell_2.\pput \; (\ell_1.\get \; s) \; v, \ell_1.\get
\; s)) = \ell_1.\pput \; s \; (\ell_2.\pput \; (\ell_1.\get \; s) \; (\delta_V(v,
\ell_2.\get \; (\ell_1.\get \; s))))
\end{equation}
Equating \cref{compose1subst} and \cref{compose3subst} hence gives
\cref{composeresult}, which is what we wanted to show.

\iffalse
\section{Weighted Posets and Difference Functions}
\begin{definition}
Let $P$ be a poset. A weight function $\rho$ on $P$ is simply an order
preserving map from $P$ to $\mathbb{R}^{\geq 0}$, the non-negative real
numbers.
\end{definition}

\begin{definition}
Let $(P, \rho)$ be a weighted poset. A function $\delta : P
\times P \longrightarrow \mathbb{R}^{\geq 0}$ is a difference function if and
only if
\begin{align*}
&\delta(a, b) \leq \rho(a) \tag{A1}\\
&\text{if } a \leq b \text{ then } \delta(a, b) = 0 \tag{A2}\\
&\text{if } a \leq a' \text{ then for all }b , \; \delta(b, a) \geq \delta(b,
a')\tag{A3}
\end{align*}
\end{definition}
\iffalse
Intuitively, $\pi_1(\delta(a, b))$ tells us how much $a$ differs from $a \wedge
b$ while $\pi_2(\delta(a, b))$ tells us how much $b$ differs from $a \wedge b$.
The advantage of the definition of difference functions is that $\delta(a, b)$
is defined even if $a \wedge b$ does not exist. Still it is instructive to
think of $a \wedge b$ to understand what the axioms are saying.

The first law says that the difference between $a$ and $a \wedge b$ is less
than or equal to $a$, and the difference between $b$ and $a \wedge b$
is less than or equal to $b$.

The second law says that the difference between $a$ and $a \wedge b$ is equal
to the difference between $b$ and $a \wedge b$ if and only if $a = b$.

The third law says that switching $a$ and $b$ and then taking the difference
is the same as taking the difference and then switching the components.

The fourth law says that if $a \leq a'$ then the difference between $b$
and $a \wedge b$ is greater than or equal to the difference between $b$ and $a'
\wedge b$.
\fi
\begin{example}\label{embedding}
Let $P$ be any set with equality giving the poset structure. Define
a weight function $\rho$ on $P$ by $\rho(a) = 1$ for all $a$. Then $\delta$
defined by $$ \delta(a, b) =
\begin{cases}
0 & \text{if } a = b\\
1 & \text{otherwise}
\end{cases}
$$
is a difference function on $P$.
\end{example}
\begin{example}\label{naturalnumbers}
Let $P$ be the weighed poset on the non-negative integers with the order $\leq$,
and weight function $\rho$ given by $Id_P$. Define $\delta(a, b) = \max\{0,
a-b\}$
\end{example}
\begin{example}\label{divisibility}
Let $P$ be the weighted poset on the non-negative integers with the division
relation and weight function $\rho$ given by $\rho(p_1^{a_1} \cdot \ldots \cdot
p_n^{a_n}) = a_1 + \ldots + a_n$. Define $\delta(a, b) = \rho(a/gcd(a, b))$.
\end{example}
\begin{example}\label{boolean}
Let $X$ be a set and $P$ the weighted poset on the finite subsets of $2^X$ with
the containment relation, and weight function $\rho$ given by $\rho(A) = |A|$.
Define $\delta(A, B) = A \setminus B$
\end{example}
\begin{example}\label{general}
Generalizing \cref{divisibility} and
\cref{boolean}, let $P$ be a complete weighted lattice with weight function
$\rho$ satisfying $\rho(x) = 0$ if and only if $x = \bigwedge P$. Define
$$\delta(a, b) = \rho\left(\bigwedge \{x \; | \; (a \wedge b) \vee x =
a\}\right)$$
\end{example}
\begin{proof}
Let $a, a', b \in P$.  Let $X = \{x \; | \; (a \wedge b) \vee x =  a\}$, $Y =
\{y \; | \; (b \wedge a) \vee y = b\}$ and $Y' = \{y' \; | \; (b \wedge a')
\vee y' = b\}$.
\begin{enumerate}
  \item[(A1)]
  Since $a \in X$ and $\delta(a, b) = \bigwedge X$, it follows that
  $\bigwedge X \leq a$, hence $\delta(a, b) = \rho\left(\bigwedge X \right) \leq
  \rho(a)$.
  \item[(A2)]
  Assume that $a \leq b$. Then $(a \wedge b) = a$, hence
  $$(a \wedge b) \vee \left(\bigwedge P\right) = a \vee\left(\bigwedge P\right)
  = a$$
  Hence $\bigwedge P \in X$, from which it follows that $\delta(a, b) =
  \rho\left(\bigwedge P\right) = 0$
  \item[(A4)]
  Assume that $a \leq a'$. First we show that $Y \subseteq Y'$. Assume that
  $y \in Y$. Since $a \wedge b \leq a' \wedge b \leq b = (a \wedge b) \vee y$,
  it follows that, $(a' \wedge b) \vee y = (a \wedge b) \vee y = b$, hence $y
  \in Y'$. Consequently, $\bigwedge Y \geq \bigwedge Y'$ from which it follows
  that $$\delta(b, a) =\rho\left(\bigwedge Y\right) \geq \rho\left(\bigwedge
  Y'\right) = \delta(b, a')$$
  This completes the proof.
\end{enumerate}
\end{proof}
\iffalse
Now define a
function $d:
P \longrightarrow \mathbb{R}$ on $P$ by $$d(a, b) =
\begin{cases}
0 & \text{if } a = b\\
\rho(\pi_1(\delta(a, b))) + \rho(\pi_2(\delta(a, b))) & \text{otherwise}
\end{cases}$$
\begin{fact}
\begin{enumerate}
  \item
  $d(a,b) \geq 0$,
  \item
  $d(a, b) = 0$ if and only if $a = b$, and
  \item
  $d(a, b) = d(b, a)$
\end{enumerate}
\end{fact}
\begin{fact}
If $b \leq c$, then for all $b$, $d(a, b) \geq d(a, c)$. Thus if $b \leq c$,
$d(a, c) \leq d(a, b) + d(b, c)$
\end{fact}
\begin{question}
Under what conditions is $d$ a metric?
\end{question}
\fi
\begin{definition}
Let $S, V$ be weighted posets. A lens $\ell : S \Leftrightarrow V$ is a
5-tuple of functions
\begin{align*}
\ell.\get &: S \longrightarrow V\\
\ell.\pput &: S \longrightarrow V \longrightarrow S\\
\ell.\create &: V \longrightarrow S\\
\delta_S &: S \times S \longrightarrow \mathbb{R}^{\geq 0}\\
\delta_V &: V \times V \longrightarrow \mathbb{R}^{\geq 0}
\end{align*}
such that $\delta_S$ and $\delta_V$ are difference functions on $S$ and $V$
respectively, and for all $s \in S, v \in V$
\begin{align*}
\ell.\get \; (\ell.\pput \; s \; v) &= v \tag{PUTGET}\\
\ell.\get \; (\ell.\create \; v) &= v \tag{CREATEGET}\\
\ell.\pput \; s \; (\ell.\get \; s) &= s \tag{GETPUT}\\
\delta_S(\ell.\pput \; s \; v, s) &= \delta_V(v, \ell.\get \; s) \tag{ISOMETRY}
\end{align*}
\end{definition}
These laws are the same as the classical lens laws except for new ISOMETRY rule,
which says that $\ell$ preserves difference functions.

Every classical lens can be made into a lens in this new sense in various
ways: for example, we can take the poset structure on $S$
and $V$ to be given by equality, with weight function 0 and $\delta$ function 0.

\section{New Posets and Difference Functions from Old}
Let $(P, \rho)$ and $(P', \rho')$ be weighted posets.

\subsection{Product of Posets}
Define the product $P \times P'$ of $P$ and $P'$ to be the set $P \times P'$
with $\leq_{P \times P'} = \leq_P \times \leq_{P'}$. Define a weight function
$(\rho \times \rho')$ on $P \times P'$ by $(\rho \times \rho')(a, b) = \rho(a)
+ \rho(b)$.
\begin{claim}
$(P \times P', \rho \times \rho')$ is a weighted poset.
\end{claim}
\begin{claim}
If $\delta_P$ and $\delta_{P'}$ are difference functions on $P$ and $P'$
respectively, then the product $\delta_P \times \delta_{P'}$ defined by
$$(\delta \times \delta')((a_1, b_1), (a_2, b_2)) = \delta(a_1, a_2) +
\delta(b_1, b_2)$$
is a difference function on $P \times P'$.
\end{claim}
\begin{proof}
Let $P, P'$ be posets with difference functions $\delta$ and $\delta'$
respectively. Then for all $a_1, a_2 \in A$ and $b_1, b_2 \in B$,
$$
(\delta \times \delta')((a_1, b_1), (a_2, b_2)) = (\delta(a_1, a_2),
\delta(b_1, b_2))
$$
We check that this definition satisfies the axioms for difference functions.
\begin{enumerate}
  \item[(A1)]
  Since $\delta$ and $\delta'$ are difference functions, then $\delta(a_1, a_2)
  \leq \rho(a_1)$ and $\delta'(b_1, b_2) \leq \rho'(b_1)$, hence $$
  (\delta \times \delta')((a_1, b_1), (a_2, b_2)) = \delta(a_1, a_2) +
  \delta(b_1, b_2) \leq \rho(a_1) + \rho'(b_1) = (\rho \times
  \rho')(a_1, b_1)$$
  \item[(A2)]
  Assume that $(a_1, b_1) \leq (a_2, b_2)$. Since $\delta$ and
  $\delta'$ are difference functions. It follows that that $\delta(a_1, a_2) =
  0$ and $\delta'(b_1, b_2) = 0$, hence $(\delta \times \delta')((a_1, b_1),
  (a_2, b_2)) = 0$.
  \item[(A3)]
  $\text{if } a \leq a' \text{ then for all }b , \; \delta(b, a) \geq \delta(b,
  a')$
  
  Assume that $(a_1, b_1) \leq (a_2, b_2)$. Then since $\delta$ and $\delta'$ are
  difference functions, it follows that $\delta(a_3, b_1) \geq \delta(a_3, b_2)$
  and $\delta'(b_3, b_1) \geq \delta'(b_3, b_2)$. Consequently,
  $$(\delta \times \delta')((a_3, b_3), (a_1, b_1)) = \delta(a_3, a_1) +
  \delta(b_3, b_1) \geq \delta(a_3, a_2) + \delta(b_3, b_2) = (\delta \times
  \delta')((a_3, b_3), (a_2, b_2))$$
  This completes the proof.
\end{enumerate}
\end{proof}
Assume that $R$ and $R'$ are regular expressions with some poset structure
defined on $\mathcal{L}(R)$ and $\mathcal{L}(R')$, and let $\delta_R$ and
$\delta_{R'}$ be difference functions defined on $\mathcal{L}(R)$ and
$\mathcal{L}(R')$ respectively. Assume that $R \cdot^! R'$. Then the product
construction gives us a way of defining a difference function $\delta_{R \cdot
R'}$ on $\mathcal{L}(R \cdot R')$ since the unambiguity condition implies that
$R \cdot R'$ is (categorically) isomorphic to $R \times R'$, the categorical
product of $R$ and $R'$.

\subsection{Coproduct of Posets}
Define the coproduct $P \sqcup P'$ of $P$ and $P'$ to be the set $P \sqcup P'$
(disjoint union of $P$ and $P'$) with $x \leq_{P \sqcup P'} y$ if and only if
$x \leq_P y$ or $x \leq_{P'} y$. Define a weight function
$(\rho \sqcup \rho')$ on $P \sqcup P'$ by
$$(\rho \sqcup \rho')(a) =
\begin{cases}
\rho(a) &\text{if }a \in P\\
\rho'(a) &\text{if }b \in P
\end{cases}$$
\begin{claim}
$(P \sqcup P', \rho \sqcup \rho')$ is a weighted poset.
\end{claim}
\begin{claim}
If $\delta_P$ and $\delta_{P'}$ are difference
functions on $P$ and $P'$ respectively, then the coproduct $\delta_P \sqcup
\delta_{P'}$ of $\delta_P$ and $\delta_{P'}$ defined by $$(\delta \sqcup
\delta')(a, b) =
\begin{cases}
\delta(a, b) &\text{if }a, b \in P\\
\delta'(a, b) &\text{if }a, b \in P'\\
(\rho \sqcup \rho')(a) & \text{otherwise}
\end{cases}$$
is a difference function on $P \sqcup P'$.
\end{claim}
\begin{proof}
We check that $\delta_P \sqcup \delta_{P'}$ satisfies the axioms for difference
functions.
\begin{enumerate}
  \item[(A1)]
  If $x, y \in P$ then
  $$
  (\delta \sqcup \delta')(x, y) = \delta(x, y) \leq \rho(x) = (\rho \sqcup
  \rho')(x)
  $$
  A similar argument shows that if $x, y \in P'$, then
  $$
  (\delta \sqcup \delta')(x, y) = \delta'(x, y) \leq \rho'(x) = (\rho \sqcup
  \rho')(x)
  $$
  Otherwise $\delta \sqcup \delta'(a, b) = (\rho \sqcup \rho')(a)$.
  \item[(A2)]
  Assume that $a \leq_{P \sqcup P'} a'$. Then either $a \leq_P a'$ or $a
  \leq_{P'} a'$, and since $\delta$ and $\delta'$ are difference functions, it
  follows that $\delta(a, a') = 0$ in either case.
  \item[(A3)]
  Assume that $a \leq_{P \sqcup P'} b$. Assume first that $a \leq_P b$. If $c
  \in P$, then $\delta(c, a) \geq \delta(c, a')$ since $\delta$ is a difference
  function. If $c \in P'$, then $\delta(c, a) = \delta(c, b) = \rho(c)$. A
  similar argument shows that if $a \leq_{P'} b$, then for all $c \in P \sqcup
  P'$, $\delta(c, a) \geq \delta(c, b)$. This completes the proof.
\end{enumerate}
\end{proof}
Assume that $R$ and $R'$ are regular expressions with some poset structure
defined on $\mathcal{L}(R)$ and $\mathcal{L}(R')$, and let $\delta_R$ and
$\delta_{R'}$ be difference functions defined on $\mathcal{L}(R)$ and
$\mathcal{L}(R')$ respectively. Assume that $\mathcal{L}(R) \cap
\mathcal{L}(R') = \varnothing$. Then the coproduct construction gives us a way
of defining a difference function $\delta_{R \; | \; R'}$ on $\mathcal{L}(R \;
| \; R')$ since the unambiguity condition implies that $R \; | \; R'$ is
(categorically) isomorphic to $R \sqcup R'$, the categorical coproduct of $R$
and $R'$.
\subsection{List Posets}
Let $P$ be a poset. Define the list poset $P^*$ of $P$ to be the set
$$P^0 \sqcup P \sqcup (P \times P) \sqcup \ldots \sqcup P^i \sqcup \ldots$$
This is just the set of all finite sequences of elements on $P$, with $P^0 =
\epsilon$, the empty sequence. The poset structure on $P^*$ is the poset
structure inherited from the product and coproduct constructions.

Assume that $R$ is a regular expression with some poset structure with $R^{*!}$.
Assume that $\delta_R$ is a difference function on $\mathcal{L}(R)$. Then
the free poset construction gives us a way of defining a difference function
on $\delta_{R^*}$ on $\mathcal{L}(R^*)$ since the unambiguity condition implies
that $R^*$ is (categorically) isomorphic to $F(R)$, the free monoid on $R$,
with $R^0 = \epsilon$, the literal empty string (i.e. the literal empty string
is sent to the categorical empty string by this isomorphism).

\subsection{A Finer Poset Structure on $P^*$}
Define a finer poset structure on $P^*$ by $x \; \leq \; y$
if and only if $x = (x_1, \ldots, x_m), \; y = (y_1, \ldots, y_n)$, $m \leq n$
and $x_i \leq y_i$ for $1 \leq i \leq m$.

Let $\delta_P$ be a difference function on $P$. We define the function
$\Delta^*$ on $P^*$ by
$$\Delta^*((x_1, \ldots, x_m), (y_1, \ldots, y_n)) = \sum_{i=1}^{\min\{m,
n\}}\delta(x_i, y_i) + \sum_{j = \min\{m, n\} + 1}^{m}\rho(x_i)$$
\begin{claim}
$\Delta^*$ is a difference function.
\end{claim}
\begin{proof}
We check that each of the axioms for difference functions holds.
\begin{enumerate}
  \item[(A1)]
  Since $\delta$ is a difference function, then $\delta(x_i, y_i)
  \leq \rho(x_i)$ for $1 \leq i \leq \min\{m, n\}$ and for $\min\{m, n\} < j <
  m$ from which it follows that
  $$\Delta^*((x_1, \ldots, x_m), (y_1,
  \ldots, y_n)) \leq \sum_{i=1}^m\rho(x_i) = \rho^*((x_1, \ldots, x_n))$$
  \item[(A2)]
  Assume that $(x_1, \ldots, x_m) \leq (y_1, \ldots, y_n)$. Then $m \leq n$,
  hence
  $$\Gamma^*((x_1, \ldots, x_m), (y_1, \ldots, y_n)) =
  \sum_{i=1}^{m}\delta(x_i, y_i) = 0,$$
  since $x_i \leq y_i$ for each $i$ and $\delta$ is a difference function.
  \item[(A3)]
  Assume that $(x_1, \ldots, x_m) \leq (y_1, \ldots, y_{m'})$. Then $m \leq
  m'$ and $x_i \leq y_i$. Also, $$\Delta^*((z_1, \ldots, z_n), (x_1,
  \ldots, x_m)) = \sum_{i=1}^{\min\{m, n\}}\delta(z_i, x_i) + \sum_{j =
  \min\{m, n\} + 1}^{n}\rho(z_i)$$ and
  $$\Delta^*((z_1, \ldots, z_n), (y_1, \ldots, y_{m'})) =
  \sum_{i=1}^{\min\{m', n\}}\delta(z_i, y_i) + \sum_{j = \min\{m', n\} +
  1}^{n}\rho(z_i)$$
  As $\delta$ is a difference function, it follows that $\delta(z_i, x_i) \geq
  \delta(z_i, y_i)$ for $1 \leq i \leq m$, hence
  $$\Delta^*((z_1, \ldots, z_n), (x_1, \ldots, x_m)) \geq \Delta^*((z_1,
  \ldots, z_n), (y_1, \ldots, y_{m'}))$$ This completes the proof.
\end{enumerate}
\end{proof}
\fi
%% Acknowledgments
\begin{acks}                            %% acks environment is optional
%% contents suppressed with 'anonymous'
%% Commands \grantsponsor{<sponsorID>}{<name>}{<url>} and
%% \grantnum[<url>]{<sponsorID>}{<number>} should be used to
%% acknowledge financial support and will be used by metadata
%% extraction tools.
This material is based upon work supported by the
\grantsponsor{GS100000001}{National Science
Foundation}{http://dx.doi.org/10.13039/100000001} under Grant
No.~\grantnum{GS100000001}{nnnnnnn} and Grant
No.~\grantnum{GS100000001}{mmmmmmm}.  Any opinions, findings, and
conclusions or recommendations expressed in this material are those
of the author and do not necessarily reflect the views of the
National Science Foundation.
\end{acks}


\bibliographystyle{plain}
\bibliography{local}

%% Appendix
%%\appendix
%%\section{Appendix}

\end{document}
