\section{Synthesis Algorithm}

\subsection{Definition}

\begin{lstlisting}[mathescape]
test $t_eu$
\end{lstlisting}

let synthrigidatom (a:atom) (b:atom) : atomlens list =\\
\hspace*{.5em}let\\
\\
let synthrigidsequence (sq:sequence) (tq:sequence) : sequencelens list =\\
\hspace*{.5em}let\\
\\
let synthrigiddnf (dr:dnfregex) (ds:dnfregex) : dnflens list =\\
\hspace*{.5em}if List.length dr <> List.length ds then None else\\
\hspace*{.5em}let permutations = retrieveallpermutations (List.length dr) in\\
\hspace*{.5em}let \\
\hspace*{.5em}let if List.exists\\
\\
let retrieveallexpansions(dr:dnfregex) : dr sequence =\\
\hspace*{.5em}let seq = List.concatmap ~f:(fun e -> applyexpansion e dr) expansions in\\
\hspace*{.5em}seq @ (List.map ~f:retrieveallexpansions seq)\\
\\
let dnfsynth (dr:dnfregex) (ds:dnfregex) (es:examples) : $dnflens_{\bot}$ =\\
\hspace*{.5em}let drqueue = retrieveallexpansion(dr) in\\
\hspace*{.5em}let dlqueue = retrieveallexpansion(dl) in\\
\\
let synth (r:regex) (s:regex) (es:examples) : $lens_{\bot}$ =\\
\hspace*{.5em}let dl=dnfsynth(dnf(r),dnf(s),e)\\
\hspace*{.5em}undnf(dl)\\


\subsection{Correctness}

\begin{theorem}[Correctness of synthrigiddnf]
If $\DNFLens \OfType \DNFRegex \Leftrightarrow \DNFRegexAlt$, then
$\DNFLens \in$ (synthrigiddnf \DNFRegex{} \DNFRegexAlt{})
\end{theorem}
\begin{proof}
\end{proof}

\begin{lemma}[Correctness of retrieveallexpansions]
If $\DNFRegex \StarOf{\RewriteDNF} \DNFRegex'$, then
$\DNFRegex'\in$ retrieveallexpansions($\DNFRegex$).
\end{lemma}
\begin{proof}
\end{proof}

\begin{theorem}[Correctness of dnfsynth]
If there exists a dnf lens
$\DNFLens \OfType \DNFRegex \Leftrightarrow \DNFRegexAlt \models \Examples$,
then dnfsynth(\DNFRegex{},\DNFRegexAlt{},\Examples{}) will return with some lens
$\DNFLens' \OfType \DNFRegex \Leftrightarrow \DNFRegexAlt \models \Examples'$.
\end{theorem}

\begin{theorem}[Correctness of synth]
If there exists a lens
$\Lens \OfType \Regex \Leftrightarrow \DNFLens \models \Examples$,
then synth(\DNFRegex{},\DNFRegexAlt{},\Examples{}) will return some lens
$\Lens' \OfType \Regex \Leftrightarrow \RegexAlt \models \Examples$
\end{theorem}
\begin{proof}
\end{proof}
