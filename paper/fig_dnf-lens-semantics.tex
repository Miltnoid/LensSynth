\begin{figure}
\centering
\begin{mathpar}
\inferrule[\IterateAtomLensRule{}]
{
\DNFLens : \DNFRegex \Leftrightarrow \DNFRegexAlt
\HasSemantics \PutRight,\PutLeft\\
\UnambigItOf{\LanguageOf{\DNFRegex}}\\
\UnambigItOf{\LanguageOf{\DNFRegexAlt}}\\
}
{
\IterateLens{\DNFLens} : \StarOf{\DNFRegex} \Leftrightarrow \StarOf{\DNFRegexAlt} \HasSemantics\\
\lambda \String.\LetWhereIn{\String_1\Concat\ldots\Concat\String_n}{\String}{\String_i\in\LanguageOf{\DNFRegex}}\\
(\PutRight\Apply\String_1)\Concat\ldots\Concat(\PutRight\Apply\String_n),\\\\
\lambda \String.\LetWhereIn{\String_1\Concat\ldots\Concat\String_n}{\String}{\String_i\in\LanguageOf{\DNFRegexAlt}}\\
(\PutLeft\Apply\String_1)\Concat\ldots\Concat(\PutLeft\Apply\String_n)
}

\inferrule[\ConjunctLensRule{}]
{
\AtomLens_1 : \Atom_1 \Leftrightarrow \AtomAlt_1 \HasSemantics \PutRight_1,\PutLeft_1\\\\
\ldots\\\\
\AtomLens_n : \Atom_n \Leftrightarrow \AtomAlt_n \HasSemantics \PutRight_n,\PutLeft_n\\\\
\sigma \in \PermutationSetOf{n}\\
\forall i \in \RangeIncInc{1}{n-1} \UnambigConcatOf{\LanguageOf{\String_{i-1}\Atom_i\epsilon}}{\LanguageOf{\String_i\Atom_{i+1}\epsilon}}\\
\forall i \in \RangeIncInc{1}{n-1} \UnambigConcatOf{\LanguageOf{\StringAlt_{i-1}\AtomAlt_{\sigma(i)}\epsilon}}{\LanguageOf{\StringAlt_i\AtomAlt_{\sigma(i+1)}\epsilon}}\\
}
{
(\ConjunctLensOf{(\String_0,\StringAlt_0)\ConjunctLensSep\Atom_1\ConjunctLensSep\ldots\ConjunctLensSep\Atom_n\ConjunctLensSep(\String_n,\StringAlt_n)},\sigma) :\\
\ConjunctOf{\String_0\ConjunctSep\Atom_1\ConjunctSep\ldots\ConjunctSep\Atom_n\ConjunctSep\String_n}\Leftrightarrow
\ConjunctOf{\StringAlt_0\ConjunctSep\AtomAlt_1\ConjunctSep\ldots\ConjunctSep\AtomAlt_n\ConjunctSep\StringAlt_n}\HasSemantics\\
\lambda \String.\LetWhereIn{\String_0\Concat\String_1'\Concat\ldots\Concat\String_n'\Concat\String_n}{\String}{\String_i'\in\LanguageOf{\Atom_i}}\\
\String_0\Concat(\PutRight_{\sigma(1)}\Apply\String_{\sigma(1)}')\Concat\ldots\Concat(\PutRight_n\Apply\String_n')\Concat\String_n,\\\\
\lambda \String.\LetWhereIn{\String_0\Concat\String_1'\Concat\ldots\Concat\String_n'\Concat\String_n}{\String}{\String_i'\in\LanguageOf{\AtomAlt_i}}\\
\String_0\Concat(\PutLeft_{\InverseOf{\sigma}(1)}\Apply\String_{\InverseOf{\sigma}(1)}')\Concat\ldots\Concat(\PutLeft_{\InverseOf{\sigma}(n)}\Apply\String_{\InverseOf{\sigma}(n)}')\Concat\String_n
}

\inferrule[\DNFLensRule{}]
{
\ConjunctLens_1 : \Conjunct_1 \Leftrightarrow \ConjunctAlt_1 \HasSemantics \PutRight_1, \PutLeft_1\\\\
\ldots\\\\
\ConjunctLens_n : \Conjunct_n \Leftrightarrow \ConjunctAlt_n \HasSemantics \PutRight_n, \PutLeft_n\\\\
\sigma \in \PermutationSetOf{n}\\
i \neq j \Rightarrow \Conjunct_{i} \cap \Conjunct_{j}=\emptyset\\
i \neq j \Rightarrow \ConjunctAlt_{i} \cap \ConjunctAlt_{j}=\emptyset\\
}
{
(\DNFLensOf{\ConjunctLens_1\DNFLensSep\ldots\DNFLensSep\ConjunctLens_n},\sigma) : \DNFOf{\Conjunct_1\DNFSep\ldots\DNFSep\Conjunct_n}
\Leftrightarrow \DNFOf{\ConjunctAlt_{\sigma(1)}\DNFSep\ldots\DNFSep\ConjunctAlt_{\sigma(n)}} \HasSemantics\\
\lambda \String.\{\PutRight_1(\String) \text{ if $\String\in\LanguageOf{\Conjunct_1}$ }, \ldots, \PutRight_n(\String) \text{ if $\String\in\LanguageOf{\Conjunct_n}$ }\},\\
\lambda \String.\{\PutLeft_1(\String) \text{ if $\String\in\LanguageOf{\ConjunctAlt_1}$ }, \ldots, \PutLeft_n(\String) \text{ if $\String\in\LanguageOf{\ConjunctAlt_n}$ }\}\\
}

\inferrule[\DNFRewriteLensRule{}]
{
\DNFRegex \RewriteDNF \DNFRegex'\\
\DNFRegexAlt \RewriteDNF \DNFRegexAlt'\\
\DNFLens \OfType \MapsBetweenTypeOf{\DNFRegex}{\DNFRegexAlt} \HasSemantics \PutRight,\PutLeft
}
{
\DNFLens \OfType \MapsBetweenTypeOf{\DNFRegex'}{\DNFRegexAlt'}
}

\end{mathpar}
\caption{DNF Lens Typing and Semantics}
\label{fig:dnf-lens-semantics}
\end{figure}
