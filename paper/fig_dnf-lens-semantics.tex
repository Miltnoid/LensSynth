\begin{figure}
\centering
\begin{mathpar}
\inferrule[\IterateAtomLensRule{}]
{
\DNFLens : \DNFRegex \Leftrightarrow \DNFRegexAlt
\HasSemantics \PutRight,\PutLeft\\
\UnambigItOf{\LanguageOf{\DNFRegex}}\\
\UnambigItOf{\LanguageOf{\DNFRegexAlt}}\\
}
{
\IterateLens{\DNFLens} : \StarOf{\DNFRegex} \Leftrightarrow \StarOf{\DNFRegexAlt} \HasSemantics\\
\lambda \String.\LetWhereIn{\String_1\Concat\ldots\Concat\String_n}{\String}{\String_i\in\LanguageOf{\DNFRegex}}\\
(\PutRight\Apply\String_1)\Concat\ldots\Concat(\PutRight\Apply\String_n),\\\\
\lambda \String.\LetWhereIn{\String_1\Concat\ldots\Concat\String_n}{\String}{\String_i\in\LanguageOf{\DNFRegexAlt}}\\
(\PutLeft\Apply\String_1)\Concat\ldots\Concat(\PutLeft\Apply\String_n)
}

\inferrule[\SequenceLensRule{}]
{
\AtomLens_1 : \Atom_1 \Leftrightarrow \AtomAlt_1 \HasSemantics \PutRight_1,\PutLeft_1\\\\
\ldots\\\\
\AtomLens_n : \Atom_n \Leftrightarrow \AtomAlt_n \HasSemantics \PutRight_n,\PutLeft_n\\\\
\sigma \in \PermutationSetOf{n}\\
\forall i \in \RangeIncInc{1}{n-1} \UnambigConcatOf{\LanguageOf{\String_{i-1}\Atom_i\epsilon}}{\LanguageOf{\String_i\Atom_{i+1}\epsilon}}\\
\forall i \in \RangeIncInc{1}{n-1} \UnambigConcatOf{\LanguageOf{\StringAlt_{i-1}\AtomAlt_{\sigma(i)}\epsilon}}{\LanguageOf{\StringAlt_i\AtomAlt_{\sigma(i+1)}\epsilon}}\\
}
{
(\SequenceLensOf{(\String_0,\StringAlt_0)\SequenceLensSep\Atom_1\SequenceLensSep\ldots\SequenceLensSep\Atom_n\SequenceLensSep(\String_n,\StringAlt_n)},\sigma) :\\
\SequenceOf{\String_0\SequenceSep\Atom_1\SequenceSep\ldots\SequenceSep\Atom_n\SequenceSep\String_n}\Leftrightarrow
\SequenceOf{\StringAlt_0\SequenceSep\AtomAlt_1\SequenceSep\ldots\SequenceSep\AtomAlt_n\SequenceSep\StringAlt_n}\HasSemantics\\
\lambda \String.\LetWhereIn{\String_0\Concat\String_1'\Concat\ldots\Concat\String_n'\Concat\String_n}{\String}{\String_i'\in\LanguageOf{\Atom_i}}\\
\String_0\Concat(\PutRight_{\sigma(1)}\Apply\String_{\sigma(1)}')\Concat\ldots\Concat(\PutRight_n\Apply\String_n')\Concat\String_n,\\\\
\lambda \String.\LetWhereIn{\String_0\Concat\String_1'\Concat\ldots\Concat\String_n'\Concat\String_n}{\String}{\String_i'\in\LanguageOf{\AtomAlt_i}}\\
\String_0\Concat(\PutLeft_{\InverseOf{\sigma}(1)}\Apply\String_{\InverseOf{\sigma}(1)}')\Concat\ldots\Concat(\PutLeft_{\InverseOf{\sigma}(n)}\Apply\String_{\InverseOf{\sigma}(n)}')\Concat\String_n
}

\inferrule[\DNFLensRule{}]
{
\SequenceLens_1 : \Sequence_1 \Leftrightarrow \SequenceAlt_1 \HasSemantics \PutRight_1, \PutLeft_1\\\\
\ldots\\\\
\SequenceLens_n : \Sequence_n \Leftrightarrow \SequenceAlt_n \HasSemantics \PutRight_n, \PutLeft_n\\\\
\sigma \in \PermutationSetOf{n}\\
i \neq j \Rightarrow \Sequence_{i} \cap \Sequence_{j}=\emptyset\\
i \neq j \Rightarrow \SequenceAlt_{i} \cap \SequenceAlt_{j}=\emptyset\\
}
{
(\DNFLensOf{\SequenceLens_1\DNFLensSep\ldots\DNFLensSep\SequenceLens_n},\sigma) : \DNFOf{\Sequence_1\DNFSep\ldots\DNFSep\Sequence_n}
\Leftrightarrow \DNFOf{\SequenceAlt_{\sigma(1)}\DNFSep\ldots\DNFSep\SequenceAlt_{\sigma(n)}} \HasSemantics\\
\lambda \String.\{\PutRight_1(\String) \text{ if $\String\in\LanguageOf{\Sequence_1}$ }, \ldots, \PutRight_n(\String) \text{ if $\String\in\LanguageOf{\Sequence_n}$ }\},\\
\lambda \String.\{\PutLeft_1(\String) \text{ if $\String\in\LanguageOf{\SequenceAlt_1}$ }, \ldots, \PutLeft_n(\String) \text{ if $\String\in\LanguageOf{\SequenceAlt_n}$ }\}\\
}

\inferrule[\DNFRewriteLensRule{}]
{
\DNFRegex \RewriteDNF \DNFRegex'\\
\DNFRegexAlt \RewriteDNF \DNFRegexAlt'\\
\DNFLens \OfType \MapsBetweenTypeOf{\DNFRegex}{\DNFRegexAlt} \HasSemantics \PutRight,\PutLeft
}
{
\DNFLens \OfType \MapsBetweenTypeOf{\DNFRegex'}{\DNFRegexAlt'}
}

\end{mathpar}
\caption{DNF Lens Typing and Semantics}
\label{fig:dnf-lens-semantics}
\end{figure}
