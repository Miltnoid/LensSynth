\begin{figure}
\centering
\begin{mathpar}
\inferrule[Constant Lens]
{
\String_1 \in \Sigma^*\\
\String_2 \in \Sigma^*\\
}
{
const(\String_1,\String_2) : \String_1 \Leftrightarrow \String_2, \String_1 \leftrightarrow \String_2
}

\inferrule[Identity Lens]
{
\Delta' \vdash \ParseTree : (\Regex, \String)
}
{
\Delta' \cup \{(\Regex,\UserDefined)\} \vdash \IdentityLens : \UserDefined \Leftrightarrow \UserDefined, \String \leftrightarrow \String
}

\inferrule[Concat Lens]
{
\Delta \vdash \Lens_1 : \Regex_1 \Leftrightarrow \RegexAlt_1, \ParseTree_1 \leftrightarrow \ParseTreeAlt_1\\
\Delta \vdash \Lens_2 : \Regex_2 \Leftrightarrow \RegexAlt_2, \ParseTree_2 \leftrightarrow \ParseTreeAlt_2\\
\Regex_1 .! \Regex_2\\
\RegexAlt_1 .! \RegexAlt_2\\
}
{
\ConcatLens{\Lens_1}{\Lens_2} : \Regex_1\Regex_2 \Leftrightarrow \RegexAlt_1\RegexAlt_2, \ParseTree_1\ParseTree_2 \leftrightarrow \ParseTreeAlt_1\ParseTreeAlt_2
}

\inferrule[Swap Lens]
{
\Delta \vdash \Lens_1 : \Regex_1 \Leftrightarrow \RegexAlt_1, \ParseTree_1 \leftrightarrow \ParseTreeAlt_1\\
\Delta \vdash \Lens_2 : \Regex_2 \Leftrightarrow \RegexAlt_2, \ParseTree_2 \leftrightarrow \ParseTreeAlt_2\\
\Regex_1 .! \Regex_2\\
\RegexAlt_2 .! \RegexAlt_1\\
}
{
\SwapLens{\Lens_1}{\Lens_2} : \Regex_1\Regex_2 \Leftrightarrow \RegexAlt_2\RegexAlt_1, \ParseTree_1\ParseTree_2 \leftrightarrow \ParseTreeAlt_2\ParseTreeAlt_1
}

\inferrule[Or Lens Left]
{
\Delta \vdash \Lens_1 : \Regex_1 \Leftrightarrow \RegexAlt_1, \ParseTree \leftrightarrow \ParseTreeAlt\\
\Lens_2 : \Regex_2 \Leftrightarrow \RegexAlt_2\\
\Regex_1 \cap \RegexAlt_1 = \emptyset\\
\Regex_2 \cap \RegexAlt_2 = \emptyset\\
}
{
\Delta \vdash \OrLens{\Lens_1}{\Lens_2} : \Regex_{1,1} | \Regex_{2,1} \Leftrightarrow \Regex_{1,2} | \Regex_{2,2}, \LeftChoiceParse{\ParseTree} \leftrightarrow \LeftChoiceParse{\ParseTreeAlt}
}

\inferrule[Or Lens Right]
{
\Lens_1 : \Regex_1 \Leftrightarrow \RegexAlt_1\\
\Delta \vdash \Lens_2 : \Regex_2 \Leftrightarrow \RegexAlt_2, \ParseTree \leftrightarrow \ParseTreeAlt\\
\Regex_1 \cap \RegexAlt_1 = \emptyset\\
\Regex_2 \cap \RegexAlt_2 = \emptyset\\
}
{
\Delta \vdash \OrLens{\Lens_1}{\Lens_2} : \Regex_{1,1} | \Regex_{2,1} \Leftrightarrow \Regex_{1,2} | \Regex_{2,2}, \RightChoiceParse{\ParseTree} \leftrightarrow \RightChoiceParse{\ParseTreeAlt}
}

\inferrule[Iterate Lens Empty]
{
\Lens : \Regex \Leftrightarrow \RegexAlt\\
\Regex^{!*}\\
\RegexAlt^{!*}\\
}
{
\Delta \vdash \IterateLens{\Lens} : \Star{\Regex_1} \Leftrightarrow \Star{\Regex_2}, \StarParse{[]} \leftrightarrow \StarParse{[]}
}

\inferrule[Iterate Lens Add Example]
{
\Delta \vdash \IterateLens{\Lens} : \Star{\Regex} \Leftrightarrow \Star{\RegexAlt}, \StarParse{\ParseTrees} \leftrightarrow \StarParse{\ParseTreeAlts}\\
\Delta \vdash \Lens : \Regex \Leftrightarrow \RegexAlt, \ParseTree \leftrightarrow \ParseTreeAlt
}
{
\Delta \vdash \IterateLens{\Lens} : \Star{\Regex} \Leftrightarrow \Star{\RegexAlt}, \StarParse{\ParseTree::\ParseTrees} \leftrightarrow \StarParse{\ParseTreeAlt::\ParseTreeAlts}
}
\end{mathpar}
\caption{Syntactic Lens and Example Typing}
\label{fig:lens-parsetree-typing}
\end{figure}
