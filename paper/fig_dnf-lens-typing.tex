\begin{figure}
\begin{mathpar}
\inferrule[Identity Atom Lens]
{
}
{
\RegexContext'\cup\{\RegexVariable,\Regex\} \vdash \IdentityLens : \RegexVariable \Leftrightarrow \RegexVariable
}

\inferrule[Lens Variable]
{
\RegexContext', \LensContext' \vdash \Lens : \Regex \Leftrightarrow \RegexAlt
}
{
\RegexContext' \cup \{(\RegexVariable,\Regex),(\RegexVariableAlt,\RegexAlt)\},
\LensContext' \cup \{(\LensVariable,\Lens)\}
\vdash \LensVariable : \RegexVariable \Leftrightarrow \RegexVariableAlt
}

\inferrule[Compose Variable]
{
\FullContext \vdash \LensVariable_1 : \RegexVariable_1 \Leftrightarrow \RegexVariable_2\\
\FullContext \vdash \LensVariable_2 : \RegexVariable_2 \Leftrightarrow \RegexVariable_3\\
}
{
\FullContext \vdash \ComposeLens{\LensVariable_2}{\LensVariable_1} : \RegexVariable_1 \Leftrightarrow \RegexVariable_3\\
}

\inferrule[Iterate Atom Lens]
{
\FullContext \vdash \DNFLens : \DNFRegex_1 \Leftrightarrow \DNFRegex_2\\
\UnambigIt{\LanguageOf{\Delta}{\DNFRegex_1}}\\
\UnambigIt{\LanguageOf{\Delta}{\DNFRegex_2}}\\
}
{
\FullContext \vdash \IterateLens{\DNFLens} : \Star{\DNFRegex_1} \Leftrightarrow \Star{\DNFRegex_2}
}

\inferrule[Clause Lens]
{
\forall i \in \RangeIncInc{1}{n}, \FullContext \vdash \AtomLens_i : \Atom_i \Leftrightarrow \AtomAlt_i\\
\sigma \in \RangeIncInc{1}{n} \rightarrowtail \RangeIncInc{1}{n}\\
\forall i \in \RangeIncInc{1}{n-1} \UnambigConcat{\LanguageOf{\Delta}{\String_{i-1}\Atom_i\epsilon}}{\LanguageOf{\Delta}{\String_i\Atom_{i+1}\epsilon}}\\
\forall i \in \RangeIncInc{1}{n-1} \UnambigConcat{\LanguageOf{\Delta}{\StringAlt_{i-1}\AtomAlt_{\sigma(i)}\epsilon}}{\LanguageOf{\Delta}{\StringAlt_i\AtomAlt_{\sigma(i+1)}\epsilon}}\\
}
{
\FullContext \vdash (\lambda i:\RangeIncInc{0}{n}.(\String_i,\StringAlt_i),\lambda i:\RangeIncInc{1}{n}.\Atom_i,\sigma) :\\
(\lambda i:\RangeIncInc{1}{n}.\Atom_i,\lambda i:\RangeIncInc{0}{n}.\String_i)\Leftrightarrow
((\lambda i:\RangeIncInc{1}{n}.\AtomAlt_i)\circ \sigma,\lambda i:\RangeIncInc{0}{n}.\StringAlt_i)\\
}

\inferrule[DNF Regex Lens]
{
\FullContext \vdash \ClauseLens_i : \Clause_i \Leftrightarrow \ClauseAlt_i\\
\sigma \in \RangeIncInc{1}{n} \rightarrowtail \RangeIncInc{1}{n}\\
i \neq j \Rightarrow \Clause_{i} \cap \Clause_{j}=\emptyset\\
i \neq j \Rightarrow \ClauseAlt_{i} \cap \ClauseAlt_{j}=\emptyset\\
}
{
\FullContext \vdash (\lambda i:\RangeIncInc{1}{n}.\ClauseLens_i,\sigma) : (\lambda i:\RangeIncInc{1}{n}.\Clause_i)
\Leftrightarrow (\lambda i:\RangeIncInc{1}{n}.\ClauseAlt_i \circ \sigma)
}
\end{mathpar}
\caption{DNF Lens Typing}
\label{fig:dnf-lens-typing}
\end{figure}
