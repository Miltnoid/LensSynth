\begin{figure}
\centering
\begin{mathpar}
\inferrule[Iterate Atom Lens]
{
\DNFLens : \DNFRegex \Leftrightarrow \DNFRegexAlt
\HasSemantics \PutRight,\PutLeft\\
\UnambigItOf{\LanguageOf{\DNFRegex}}\\
\UnambigItOf{\LanguageOf{\DNFRegexAlt}}\\
}
{
\IterateLens{\DNFLens} : \Star{\DNFRegex} \Leftrightarrow \Star{\DNFRegexAlt} \HasSemantics\\
\lambda \String.\LetWhereIn{\String_1\Concat\ldots\Concat\String_n}{\String}{\String_i\in\LanguageOf{\DNFRegex}}\\
(\PutRight\Apply\String_1)\Concat\ldots\Concat(\PutRight\Apply\String_n),\\\\
\lambda \String.\LetWhereIn{\String_1\Concat\ldots\Concat\String_n}{\String}{\String_i\in\LanguageOf{\DNFRegexAlt}}\\
(\PutLeft\Apply\String_1)\Concat\ldots\Concat(\PutLeft\Apply\String_n)
}

\inferrule[Conjunct Lens]
{
\AtomLens_1 : \Atom_1 \Leftrightarrow \AtomAlt_1 \HasSemantics \PutRight_1,\PutLeft_1\\\\
\ldots\\\\
\AtomLens_n : \Atom_n \Leftrightarrow \AtomAlt_n \HasSemantics \PutRight_n,\PutLeft_n\\\\
\sigma \in \PermutationSetOf{n}\\
\forall i \in \RangeIncInc{1}{n-1} \UnambigConcatOf{\LanguageOf{\String_{i-1}\Atom_i\epsilon}}{\LanguageOf{\String_i\Atom_{i+1}\epsilon}}\\
\forall i \in \RangeIncInc{1}{n-1} \UnambigConcatOf{\LanguageOf{\StringAlt_{i-1}\AtomAlt_{\sigma(i)}\epsilon}}{\LanguageOf{\StringAlt_i\AtomAlt_{\sigma(i+1)}\epsilon}}\\
}
{
([(\String_0,\StringAlt_0);\Atom_1;\ldots;\Atom_n;(\String_n,\StringAlt_n)],\lambda i:\RangeIncInc{1}{n}.\Atom_i,\sigma) :\\
[\String_0;\Atom_1;\ldots;\Atom_n;\String_n]\Leftrightarrow
[\StringAlt_0;\AtomAlt_1;\ldots;\AtomAlt_n;\StringAlt_n]\HasSemantics\\
\lambda \String.\LetWhereIn{\String_0\Concat\String_1'\Concat\ldots\Concat\String_n'\Concat\String_n}{\String}{\String_i'\in\LanguageOf{\Atom_i}}\\
\String_0\Concat(\PutRight_{\sigma(1)}\Apply\String_{\sigma(1)}')\Concat\ldots\Concat(\PutRight_n\Apply\String_n')\Concat\String_n,\\\\
\lambda \String.\LetWhereIn{\String_0\Concat\String_1'\Concat\ldots\Concat\String_n'\Concat\String_n}{\String}{\String_i'\in\LanguageOf{\AtomAlt_i}}\\
\String_0\Concat(\PutLeft_{\InverseOf{\sigma}(1)}\Apply\String_{\InverseOf{\sigma}(1)}')\Concat\ldots\Concat(\PutLeft_{\InverseOf{\sigma}(n)}\Apply\String_{\InverseOf{\sigma}(n)}')\Concat\String_n
}

\inferrule[DNF Regex Lens]
{
\ConjunctLens_1 : \Conjunct_1 \Leftrightarrow \ConjunctAlt_1 \HasSemantics \PutRight_1, \PutLeft_1\\\\
\ldots\\\\
\ConjunctLens_n : \Conjunct_n \Leftrightarrow \ConjunctAlt_n \HasSemantics \PutRight_n, \PutLeft_n\\\\
\sigma \in \PermutationSetOf{n}\\
i \neq j \Rightarrow \Conjunct_{i} \cap \Conjunct_{j}=\emptyset\\
i \neq j \Rightarrow \ConjunctAlt_{i} \cap \ConjunctAlt_{j}=\emptyset\\
}
{
([\ConjunctLens_1;\ldots;\ConjunctLens_n],\sigma) : [\Conjunct_1;\ldots;\Conjunct_n]
\Leftrightarrow [\ConjunctAlt_{\sigma(1)};\ldots;\ConjunctAlt_{\sigma(n)}] \HasSemantics\\
\lambda \String.\{\PutRight_1(\String) \text{ if $\String\in\LanguageOf{\Conjunct_1}$ }, \ldots, \PutRight_n(\String) \text{ if $\String\in\LanguageOf{\Conjunct_n}$ }\},\\
\lambda \String.\{\PutLeft_1(\String) \text{ if $\String\in\LanguageOf{\ConjunctAlt_1}$ }, \ldots, \PutLeft_n(\String) \text{ if $\String\in\LanguageOf{\ConjunctAlt_n}$ }\}\\
}

\inferrule[DNF Rewrite Lens]
{
\DNFRegex \RewriteDNF \DNFRegex'\\
\DNFRegexAlt \RewriteDNF \DNFRegexAlt'\\
\DNFLens \OfType \MapsBetweenTypeOf{\DNFRegex}{\DNFRegexAlt} \HasSemantics \PutRight,\PutLeft
}
{
\DNFLens \OfType \MapsBetweenTypeOf{\DNFRegex'}{\DNFRegexAlt'}
}

\end{mathpar}
\caption{DNF Lens Typing and Semantics}
\label{fig:dnf-lens-alternate-alternate-semantics}
\end{figure}
